<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 21 数理モデル（Modeling） | データサイエンスをはじめましょう - Data Science for All -</title>
<meta name="author" content="鈴木寛（Hiroshi Suzuki）">
<meta name="description" content="21.1 はじめに データサイエンスにおいて、数理モデルを考えるとはどのようなことを意味するのでしょうか。簡単な表現は、データの（主要な）特徴の簡単な概要、またはそれを（いくつかの）数値で表現すること、と言ってもよいと思います。 image...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 21 数理モデル（Modeling） | データサイエンスをはじめましょう - Data Science for All -">
<meta property="og:type" content="book">
<meta property="og:url" content="https://icu-hsuzuki.github.io/ds4aj/modeling.html">
<meta property="og:description" content="21.1 はじめに データサイエンスにおいて、数理モデルを考えるとはどのようなことを意味するのでしょうか。簡単な表現は、データの（主要な）特徴の簡単な概要、またはそれを（いくつかの）数値で表現すること、と言ってもよいと思います。 image...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 21 数理モデル（Modeling） | データサイエンスをはじめましょう - Data Science for All -">
<meta name="twitter:description" content="21.1 はじめに データサイエンスにおいて、数理モデルを考えるとはどのようなことを意味するのでしょうか。簡単な表現は、データの（主要な）特徴の簡単な概要、またはそれを（いくつかの）数値で表現すること、と言ってもよいと思います。 image...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">データサイエンスをはじめましょう<br>
- Data Science for All -</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">データサイエンスをはじめましょう</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> はじめに</a></li>
<li><a class="" href="what2learn.html"><span class="header-section-number">2</span> 学ぶ内容　</a></li>
<li><a class="" href="first-example.html"><span class="header-section-number">3</span> はじめてのデータサイエンス</a></li>
<li><a class="" href="wdi-site.html"><span class="header-section-number">4</span> 世界開発指標とオープンデータ</a></li>
<li><a class="" href="notebook.html"><span class="header-section-number">5</span> データサイエンス ノートブック</a></li>
<li class="book-part">第一部 オープンデータ</li>
<li><a class="" href="publicdata-site.html"><span class="header-section-number">6</span> オープンデータ</a></li>
<li><a class="" href="worldbank-site.html"><span class="header-section-number">7</span> 世界銀行（World Bank）</a></li>
<li><a class="" href="oecd-site.html"><span class="header-section-number">8</span> OECD（経済協力開発機構）</a></li>
<li><a class="" href="un-site.html"><span class="header-section-number">9</span> United Nations（国際連合）</a></li>
<li><a class="" href="owid-site.html"><span class="header-section-number">10</span> Our World in Data</a></li>
<li><a class="" href="estat-site.html"><span class="header-section-number">11</span> e-Stat 日本の政府統計</a></li>
<li><a class="" href="sdgs-site.html"><span class="header-section-number">12</span> SDGs</a></li>
<li><a class="" href="other-site.html"><span class="header-section-number">13</span> その他のサイト</a></li>
<li class="book-part">第二部 R の基礎</li>
<li><a class="" href="ronrstudio.html"><span class="header-section-number">14</span> R Studio で R</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">15</span> R Markdown</a></li>
<li><a class="" href="rbasics.html"><span class="header-section-number">16</span> base R</a></li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">17</span> Tidyverse</a></li>
<li><a class="" href="transform.html"><span class="header-section-number">18</span> 変形（Transform）</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">19</span> 視覚化（Visualize）</a></li>
<li><a class="" href="import.html"><span class="header-section-number">20</span> データ読み込み（Import）</a></li>
<li><a class="active" href="modeling.html"><span class="header-section-number">21</span> 数理モデル（Modeling）</a></li>
<li><a class="" href="communicate.html"><span class="header-section-number">22</span> 情報共有（Communicate）</a></li>
<li><a class="" href="aboutfirstexample.html"><span class="header-section-number">23</span> 復習</a></li>
<li class="book-part">第三部 オープンデータの活用</li>
<li><a class="" href="publicdata.html"><span class="header-section-number">24</span> オープンデータの分析</a></li>
<li><a class="" href="worldbank.html"><span class="header-section-number">25</span> 世界銀行（World Bank）</a></li>
<li><a class="" href="oecd.html"><span class="header-section-number">26</span> OECD（経済協力開発機構）</a></li>
<li><a class="" href="un.html"><span class="header-section-number">27</span> UN Data（国際連合データ）</a></li>
<li><a class="" href="owid.html"><span class="header-section-number">28</span> Our World in Data</a></li>
<li><a class="" href="wid.html"><span class="header-section-number">29</span> 世界不平等データベース</a></li>
<li><a class="" href="estat.html"><span class="header-section-number">30</span> e-Stat</a></li>
<li><a class="" href="others.html"><span class="header-section-number">31</span> その他のデータベース</a></li>
<li class="book-part">PART IV EDA</li>
<li><a class="" href="intro2eda.html"><span class="header-section-number">32</span> 探索的データ解析</a></li>
<li><a class="" href="worldmap.html"><span class="header-section-number">33</span> 地図 Choropleth Maps</a></li>
<li class="book-part">PART V EXAMPLES</li>
<li><a class="" href="example1.html"><span class="header-section-number">34</span> Example 1</a></li>
<li><a class="" href="references.html"><span class="header-section-number">35</span> 参考文献</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="japanese.html"><span class="header-section-number">A</span> 日本語の扱いについて</a></li>
<li><a class="" href="tools.html"><span class="header-section-number">B</span> IT ツール</a></li>
<li><a class="" href="bookdown-original.html"><span class="header-section-number">C</span> Bookdown</a></li>
<li><a class="" href="todo-list.html"><span class="header-section-number">D</span> To Do リスト</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/icu-hsuzuki/ds4aj">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="modeling" class="section level1" number="21">
<h1>
<span class="header-section-number">21</span> 数理モデル（Modeling）<a class="anchor" aria-label="anchor" href="#modeling"><i class="fas fa-link"></i></a>
</h1>
<div id="はじめに-4" class="section level2" number="21.1">
<h2>
<span class="header-section-number">21.1</span> はじめに<a class="anchor" aria-label="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB-4"><i class="fas fa-link"></i></a>
</h2>
<p>データサイエンスにおいて、数理モデルを考えるとはどのようなことを意味するのでしょうか。簡単な表現は、データの（主要な）特徴の簡単な概要、またはそれを（いくつかの）数値で表現すること、と言ってもよいと思います。</p>
<div class="float">
<img src="data/data-science.png" alt="image"><div class="figcaption">image</div>
</div>
<p>その意味では、平均値や、中央値、四分位、最大値、最小値などの、代表値と言われるものも、そうですし、正規分布など、特定の分布に近い場合に、それを定める、平均値と、標準偏差の組みも、ひとつの数理モデルを与えると言えるでしょう。</p>
<p>ここでは、もう少し一般的な分布に関して使われる、数理モデルについて学びます。その中でも、基本的な、二変数に関する、線形モデルについてすこし、ていねいにみていきたいと思います。</p>
<p>簡単にいうと、X と Y という変数があったときに、X が増えると、Y も増えるとか、減るとか、X が増加すると、Y も増加するとか、減少するとかいう傾向をみたり、それが、どの程度、直線的に、増加、減少しているかを、<span class="math inline">\(Y = b + m\cdot X\)</span> と、直線の方程式で近似し（おおまかに表し）、それが、どの程度、実際のデータに近いかを表現する（あらわす数値をあたえる）というようなことです。</p>
<p>Y を X の関数で表す（X を定めると、Y を計算することができる）とも表現され、X を独立変数（independent variable）、Y を従属変数（dependent variable）と呼びます。むろん、X と Y の役割を逆にすることも可能なので、便宜的な名前です。また、統計学では、Y を目的変数（response variable）、X を説明変数（explanatory variable）と呼ぶ呼び方もされます。ただ、これらは、X によって、Y が定まるという、因果関係を表すという考え方が背景にあるのですが、傾向や関係性を見るという観点からは、これらの名前を使うことを避けたほうがよいとも言えますので、ここでは、独立変数、従属変数、説明変数、目的変数という言い方は、できるだけ避けたいと思います。</p>
<p>R では、<span class="math inline">\(b\)</span>（Y 切片）は、intercept（切片）として表示され、<span class="math inline">\(m\)</span>（直線の傾き）は、（変数　X に関する）slope（傾き）として表示されます。</p>
<p>R を使って、モデルについて表示される、数値の意味も説明したいと思います。数式での表現も書きますが、式を正確に覚えたりするよりも、大まかな意味を理解することを心がけてください。</p>
<p>数理モデルは、非常に多様なだけでなく（主要な）特徴は、分野ごとに必要度が異なることから、一般論として述べることには限界があります。H. ウィッカム（Hadley Wickham, el. al.）の R for Data Science の標準的な教科書でも、第一版には、基本的なことが含まれていましたが、<a href="https://r4ds.hadley.nz">第二版</a> には、数理モデルは含まれていません。<a href="https://www.tmwr.org">Tidy Modeling with R</a> を参照するようにとリンクがついています。</p>
<p>ここでは、オープンデータを用いたデータサイエンス、データ分析を学んでいます。基本的な線形モデルについて紹介しますが、そのモデルが適切かを判断しようとすると、t-検定や、F-検定を適用することが多いのですが、いずれも、正規分布を仮定しています。実際の社会、様々な国や、地域などを比較して検討するときに、そのデータが、正規分布をしているかどうかは、それほど簡単に判断できるわけではありません。また、これも、ある統計的な道具を使って、正規分布に近いことがある程度保証できたとしても、それに、線形モデルを適用して、どの程度適切な結果が得られるか、個人的には判断が難しいと思います。さらに、相関関係やその強さはわかっても、線形モデルなどから、因果関係を導くことはできません。個人的には、線形の関係がみてとれる、程度で、止めておくことが大切ではないかと考えています。安易に、t-検定や、F-検定を用いて、結論を導くのは、差し控えるべきで、ある結果を導くときには、ほかにも、さまざまな根拠をもつことがたいせつだと、個人的には大切だと考えます。</p>
<p>ということで、説明はしますが、自分は、統計がわからないから、データサイエンスはできないなどとは、言ってほしくないと思っています。統計の深い知識がなくても、データの様々な特徴を見て取ることは、可能だと思います。</p>
</div>
<div id="準備setup" class="section level2" number="21.2">
<h2>
<span class="header-section-number">21.2</span> 準備（Setup）<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99setup"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.3     ✔ readr     2.1.4</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.0</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.4.3     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.2     ✔ tidyr     1.3.0</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/WDI/">WDI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching packages ────────────────── tidymodels 1.1.1 ──</span></span>
<span><span class="co">#&gt; ✔ broom        1.0.5     ✔ rsample      1.2.0</span></span>
<span><span class="co">#&gt; ✔ dials        1.2.0     ✔ tune         1.1.2</span></span>
<span><span class="co">#&gt; ✔ infer        1.0.5     ✔ workflows    1.1.3</span></span>
<span><span class="co">#&gt; ✔ modeldata    1.2.0     ✔ workflowsets 1.0.1</span></span>
<span><span class="co">#&gt; ✔ parsnip      1.1.1     ✔ yardstick    1.2.0</span></span>
<span><span class="co">#&gt; ✔ recipes      1.0.8     </span></span>
<span><span class="co">#&gt; ── Conflicts ───────────────────── tidymodels_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ scales::discard() masks purrr::discard()</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter()   masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ recipes::fixed()  masks stringr::fixed()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()      masks stats::lag()</span></span>
<span><span class="co">#&gt; ✖ yardstick::spec() masks readr::spec()</span></span>
<span><span class="co">#&gt; ✖ recipes::step()   masks stats::step()</span></span>
<span><span class="co">#&gt; • Use tidymodels_prefer() to resolve common conflicts.</span></span></code></pre></div>
<p>Tidymodels パッケージを使いますが、これは、Tidyverse と同様に、一つのパッケージではなく、パッケージ群を表します。また、ここでは、ほんの一部しか使いませんが、一応、後々のために、インストールをし、使えるように <code><a href="https://tidymodels.tidymodels.org">library(tidymodels)</a></code> で、読み込んでおいてください。興味のあるかたのために、Tidymodels サイトへのリンクを付けておきます。</p>
<ul>
<li>tidymodels: <a href="https://www.tidymodels.org" class="uri">https://www.tidymodels.org</a>
</li>
</ul>
</div>
<div id="線形モデル入門" class="section level2" number="21.3">
<h2>
<span class="header-section-number">21.3</span> 線形モデル入門<a class="anchor" aria-label="anchor" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E5%85%A5%E9%96%80"><i class="fas fa-link"></i></a>
</h2>
<p>起動時に読み込まれる、datasets パッケージの、iris データを用いて、概要をみてみます。iris には、三種類の、あやめのデータが含まれていますが、ここでは、verginica と versicolor、すなわち、setosa 以外について扱います。</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html">iris</a></span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">!=</span> <span class="st">"setosa"</span><span class="op">)</span></span></code></pre></div>
<p>二つの散布図を見てみます。一つ目は、X 軸が、花弁幅（はなびらのはば）、Y 軸が、花弁長（はなびらの長さ）、二つ目は、X 軸が、萼幅（がくのはば）、Y 軸が、花弁長（がくの長さ）を表した散布図です。</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal.Width</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>どちらも、幅（はなびらの幅や、がくの幅）が大きくなると、長さ（はなびらの長さや、がくの長さ）が大きくなる傾向があるように見えます。それは、なんとなく直感的にも自然ですよね。種類が同じ植物のはなびらや、がくの形は、だいたい同じ（相似形にちかい）と思われるからです。（直感はとてもたいせつです。直感とあわないことがあれば、立ち止まって考えて見るようにしてください。）しかし、はなびらの散布図は、それが明らかにみてとれるだけでなく、ある直線にそって（または直線的に）増加しているように見えます。がくの散布図では、その傾向が明らかではなく（ぼんやりとしていて）、直線にそって増加しているとまでは言えないように見えます。</p>
<p>すこし、違った、見方をする方もおられるかもしれません。定義を明確にすることで、合意ができるように、それを、数値的に表現するのが、線形モデルを使った表現です。まずは、それぞれに、増加傾向をあらわす直線を描いてみましょう。これは、ある一定の方法で描いたもので、歴史的背景から、回帰直線（regression line）と呼ばれすが、いまは、大体、そんなものだと考えてくださって構いません。</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal.Width</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>,formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>,formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
<p>たしかに、この二つの散布図と、直線を見ると、それぞれ（はなびらや、がくの）幅が増加すると長さも増加する傾向にあるようです。そこで、今度は、直線に近い、増加傾向にあると仮定して、適切な直線の方程式を求めてみます。それは、次のようにして求めることができます。</p>
<div id="線形モデルの例linear-models-by-examples" class="section level3" number="21.3.1">
<h3>
<span class="header-section-number">21.3.1</span> 線形モデルの例（Linear Models by Examples）<a class="anchor" aria-label="anchor" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E4%BE%8Blinear-models-by-examples"><i class="fas fa-link"></i></a>
</h3>
<div id="linear-model-petal.length-petal.width" class="section level4" number="21.3.1.1">
<h4>
<span class="header-section-number">21.3.1.1</span> Linear Model: Petal.Length ~ Petal.Width<a class="anchor" aria-label="anchor" href="#linear-model-petal.length-petal.width"><i class="fas fa-link"></i></a>
</h4>
<p>はなびらの長さを、はなびらの幅を変数とする、直線の方程式で近似してみます。</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Petal.Length ~ Petal.Width, data = df_iris0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)  Petal.Width  </span></span>
<span><span class="co">#&gt;       2.224        1.600</span></span></code></pre></div>
<p>Call の部分は、「このような（X を Petal.Width として、Y を Petal.Length の一次式、すなわち、<span class="math inline">\(Y = b + m\cdot X\)</span> と表わそうと）線形モデルで考えると」といった、意味です。</p>
<p>Coefficients は、係数の意味です。次に、(Intercept) が、2.224、Petal.Width が 1.600 とありますから、1.600 が 一次式で表したときの Petal.Width の係数で、式で書くと次のようになります。</p>
<p>Formula: <span class="math inline">\(\text{Petal.Length} = 2.224 + 1.600\cdot \text{Petal.Width}\)</span></p>
<p>Petal.Width の範囲が限られていますから、Y 切片は確認できませんが、だいたい見当が付きますし、傾きは、X が 1 大きくなると、Y がどれぐらい大きくなるかという数ですから、だいたい、見当がつきますね。</p>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
</div>
<div id="linear-model-sepal.length-sepal.width" class="section level4" number="21.3.1.2">
<h4>
<span class="header-section-number">21.3.1.2</span> Linear Model: Sepal.Length ~ Sepal.Width<a class="anchor" aria-label="anchor" href="#linear-model-sepal.length-sepal.width"><i class="fas fa-link"></i></a>
</h4>
<p>がくの長さを、がくの幅を変数とする、直線の方程式で近似してみます。</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Sepal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Sepal.Length ~ Sepal.Width, data = df_iris0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)  Sepal.Width  </span></span>
<span><span class="co">#&gt;       3.093        1.103</span></span></code></pre></div>
<p>式は、次のようになっていることがわかります。</p>
<p>Formula: <span class="math inline">\(\text{Sepal.Length} = 3.093 + 1.103\cdot \text{Sepal.Width}\)</span></p>
<p>下のグラフから、だいたいの、Y 切片や、傾きを読み取って、上の式と比較してください。</p>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-10-1.png" width="672"></div>
</div>
<div id="決定係数r-squared" class="section level4" number="21.3.1.3">
<h4>
<span class="header-section-number">21.3.1.3</span> 決定係数（R squared）<a class="anchor" aria-label="anchor" href="#%E6%B1%BA%E5%AE%9A%E4%BF%82%E6%95%B0r-squared"><i class="fas fa-link"></i></a>
</h4>
<p>日本語では、決定係数と呼ばれることが多いようですが、R squared の意味を簡単に説明します。</p>
<p>まず、決定係数（R squared）は、0 と 1 の間の値を取ります。モデルの当てはまり具合を表す数とも表現されます。</p>
<p>The coefficient of determination R2 represents the strength of fit of the model.</p>
<p>このモデル（現在の場合は X の関数として、Y の値をおおまかに表現する線形モデル）によって、どのていど、実際の値が決まるかをあらわす一つの指標です。この値が、1 のときは、ピッタリ合致していることを意味し、0 のときは、X の値に依存しない、平均値と、変わらないという意味です。たとえば、はなびらモデルでは、下のようになりますから、68％ 程度決定する、または、適合するという言い方をします。がくモデルの場合には、31% 程度決定する、または、適合するという言い方をします。はなびらモデルのほうが、がくモデルよりもより直線的といいうことを表す数ということになります。</p>
<p>(Multiple) R Squared: a value between 0 and 1, the model’s strength. It is a measurement of the model quality. If the value is close to 1, the model quality is high. If it is close to 0, the model quality is low.</p>
<p>Petal.Length ~ Petal.Width: R squared = 0.6779 - 68%</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Petal.Length ~ Petal.Width, data = df_iris0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -0.9842 -0.3043 -0.1043  0.2407  1.2755 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   2.2240     0.1926   11.55   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Petal.Width   1.6003     0.1114   14.36   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.4709 on 98 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.6779, Adjusted R-squared:  0.6746 </span></span>
<span><span class="co">#&gt; F-statistic: 206.3 on 1 and 98 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Sepal.Length ~ Sepal.Width: R squared = 0.3068 - 31%</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Sepal.Width</span>, data <span class="op">=</span><span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Sepal.Length ~ Sepal.Width, data = df_iris0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -1.0032 -0.3877 -0.0774  0.3200  1.7381 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   3.0934     0.4844   6.387 5.70e-09 ***</span></span>
<span><span class="co">#&gt; Sepal.Width   1.1033     0.1675   6.585 2.27e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.5547 on 98 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.3068, Adjusted R-squared:  0.2997 </span></span>
<span><span class="co">#&gt; F-statistic: 43.36 on 1 and 98 DF,  p-value: 2.27e-09</span></span></code></pre></div>
<p>上のように、summary() 関数をつかうと、Multiple R-squared や、Adjusted R-squared と R squared 値は、出てきますが、現在の場合は、Multiple R-squared が、決定係数だと考えてください。</p>
<p>いまは、Y を、X の関数として表しましたが、X ではなく、X<sub>1</sub>、X<sub>2</sub>、などとたくさんの変数を使って、表し、全体のデータ（観測値）の個数が、あまり多くないときは、Multiple R-squared よりも、Adjusted R-squared のほうが、より適切になってくるばあいはあるので、このように、2つの数が書かれています。</p>
<p>また、決定係数（R squared）は、線形モデル以外にも使えますので、モデルの適合性を表す、たいせつな指標のひとつと理解しておいてください。</p>
<p>summary() には、他にもたくさんの、値が出ています。あとで、それぞれについて、簡単に見ていきたいと思います。</p>
<p>決定係数が1に近いと良い（強い）モデルで、0に近いと悪い（弱い）モデルということになりますが、どの程度ならば、良いモデルかは一概に言えません。分野にもよりますが、0.3 より小さければ、あまりよいモデルだとは言えず、0.7 より大きければ、よいモデルのひとつだと考えても良いのではないかと思います。</p>
<p>上の2つのモデルは、微妙ですが、花びらモデルのほうが、良い（より適合した）モデルだと表現できます。</p>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
</div>
</div>
<div id="線形モデルの基礎linear-model-basics-y-x" class="section level3" number="21.3.2">
<h3>
<span class="header-section-number">21.3.2</span> 線形モデルの基礎（Linear Model Basics）: y ~ x<a class="anchor" aria-label="anchor" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%9F%BA%E7%A4%8Elinear-model-basics-y-x"><i class="fas fa-link"></i></a>
</h3>
<p>R では、線形モデルを次のように定めます。<code>y~x</code> は、x の関数で、y を表すという意味です。パイプを使うときは、その下の式のようになります。パイプは原則として、最初の変数として、一つ前の出力が読み込まれますが、<code>lm(arg1, arg2)</code> の場合には、<code>arg2</code> 2つ目の変数が、データですから、それを表すために、<code>data = _</code> (または、%&gt;% の場合には、そこに、ピリオッド（半角））を書き、そのことを示します。場所指定の ‘_’ （または ‘.’） (place holder) と言います。</p>
<pre><code>lm(y~x, data)</code></pre>
<pre><code>data |&gt; lm(y~x, data=_) # data = をつけないとエラーになります</code></pre>
<pre><code>data %&gt;% lm(y~x, .)</code></pre>
<p>y 切片や、傾きが得られます。（y-intercept, and slope: rate of increase or decrease）</p>
<p>モデルのより詳細な情報は、summry() によって得ることができます。パイプを使う場合には、その次のコードとなります。</p>
<pre><code>summary(lm(y~x, data))</code></pre>
<pre><code>data |&gt; lm(y~x, .) |&gt; summary()</code></pre>
<p>具体的な例から、それぞれの数値がなにを表しているのか見ていきましょう。</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">2</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ybar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>, <span class="va">df1</span><span class="op">)</span></span>
<span><span class="fu">augment</span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">ybar</span>, linetype<span class="op">=</span><span class="st">"longdash"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ybar</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">.fitted</span><span class="op">)</span>, shape <span class="op">=</span><span class="fl">9</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ybar</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>,<span class="va">x</span>,<span class="st">","</span>,<span class="fl">1.25</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">.fitted</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>,<span class="va">x</span>,<span class="st">","</span>,<span class="va">.fitted</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"("</span>,<span class="va">x</span>,<span class="st">","</span>,<span class="va">y</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> </span></code></pre></div>
<ul>
<li>
<span class="math inline">\((x_1, y_1)\)</span>, <span class="math inline">\((x_2,y_2)\)</span>, <span class="math inline">\((x_3, y_3)\)</span>, <span class="math inline">\((x_4, y_4)\)</span>: Data points - データの4つの点をあらわす黒点</li>
<li>
<span class="math inline">\(\bar{y}\)</span>: mean of y = <span class="math inline">\((y_1 + y_2 + y_3 + y_4)/4\)</span>. （相加）平均値を表す赤線</li>
<li>
<span class="math inline">\(\hat{y}_i\)</span>: prediction at <span class="math inline">\(x_i\)</span>, 線形モデルの一次式で与えられる値
<ul>
<li>
<span class="math inline">\((x_1, \hat{y}_1)\)</span>, <span class="math inline">\((x_2, \hat{y}_2)\)</span>, <span class="math inline">\((x_3, \hat{y}_3)\)</span>, <span class="math inline">\((x_4, \hat{y}_4)\)</span> are on the regression line. 回帰直線上の◇で表された点</li>
</ul>
</li>
<li>
<span class="math inline">\(y_1-\hat{y}_1\)</span>, <span class="math inline">\(y_2-\hat{y}_2\)</span>, <span class="math inline">\(y_2-\hat{y}_2\)</span>, <span class="math inline">\(y_2-\hat{y}_2\)</span> are called residues. 実際の値から、モデルでの予測値を引いたもので、残差と呼ばれます</li>
</ul>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-15-1.png" width="672"></div>
<p>線形モデルの一次式で与えられる値（fitted values）は次のようにしても表示できます。</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span><span class="op">$</span><span class="va">fitted.values</span></span>
<span><span class="co">#&gt;   1   2   3   4 </span></span>
<span><span class="co">#&gt; 0.8 1.1 1.4 1.7</span></span></code></pre></div>
<div id="決定係数r-squared-1" class="section level4" number="21.3.2.1">
<h4>
<span class="header-section-number">21.3.2.1</span> 決定係数（R Squared）<a class="anchor" aria-label="anchor" href="#%E6%B1%BA%E5%AE%9A%E4%BF%82%E6%95%B0r-squared-1"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math inline">\(SS_{tot}\)</span> は、実際の値から平均値を引いたものを、二乗して足したものです。二乗してあるので、かならず正（正確には非負）になります。</p>
<p><span class="math inline">\(SS_{res}\)</span> は、実際の値から（この線形）モデルによって予測したあたいを引いたものを、二乗して足したものです。二乗してあるので、かならず正（正確には非負）になります。</p>
<p><span class="math inline">\(R^2\)</span> は、一番下の式で定義されます。完全に予測が実際の値と一致していると、<span class="math inline">\(SS_{res}\)</span> は、0 になりますから、その場合は、商の分子が 0 で、<span class="math inline">\(R^2\)</span> の値は、1 になります。</p>
<p>線形モデルの、直線の方程式は、直線の中で、<span class="math inline">\(SS_{res}\)</span> が一番小さくなるものを（最小二乗法という方法で）選んであり、平均を通る直線をから計算したものよりは、小さくなるので、商の部分は、1 以下、すなわち、<span class="math inline">\(R^2\)</span> の値は、0 以上 1 以下となります。</p>
<p><span class="math display">\[SS_{tot} = (1-1.25)^2 + (0.5-1.25)^2 + (2-1.25)^2 + (1.5-1.25)^2 = 1.25\]</span> <span class="math display">\[SS_{res} = (1-0.8)^2 + (0.5-1.1)^2 + (2-1.4)^2 + (1.5-1.7)^2 = 0.8\]</span> <span class="math display">\[R^2 = 1 - \frac{SS_{res}}{SS_{tot}} = 1- \frac{0.8}{1.25} = 0.36.\]</span></p>
<p>実際に、<code>mod1</code> の <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> から値を取り出す方法をいくつか書いておきます。<code>glance</code> は、<code>tidymodel</code> に含まれる、パッケージ <code>broom</code> の関数で、モデルの概要（summary）を、表（この場合は、tidyverse の標準の tibble）として出力するものです。</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span></span>
<span><span class="co">#&gt; [1] 0.36</span></span></code></pre></div>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[7],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.36","2":"0.04","3":"0.6324555","4":"1.125","5":"0.4","6":"1","7":"2","8":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">|&gt;</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.36</span></span></code></pre></div>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">|&gt;</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>`R Squared` <span class="op">=</span> <span class="va">r.squared</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["R Squared"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.36"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="モデル概要" class="section level3" number="21.3.3">
<h3>
<span class="header-section-number">21.3.3</span> モデル概要<a class="anchor" aria-label="anchor" href="#%E3%83%A2%E3%83%87%E3%83%AB%E6%A6%82%E8%A6%81"><i class="fas fa-link"></i></a>
</h3>
<p>一般的な場合に、それぞれの数値を表す数式（Mathematical Formula）と簡単な説明を記します。</p>
<ul>
<li>
<span class="math inline">\(x = c(x_1, x_2, \ldots, x_n)\)</span> : X 変数（the X (independent) variable） 例 Petal.Width</li>
<li>
<span class="math inline">\(y = c(y_1, y_2, \ldots, y_n)\)</span> ：Y 変数（the Y (dependent) variable） 例 Petal.Length</li>
<li>
<span class="math inline">\(\mbox{pred} = c(\hat{y}_1, \hat{y}_2, \ldots, \hat{y}_n)\)</span> ：モデル予測値（the predicted values by a (linear regression) model）例 <span class="math inline">\(\hat{y}_i = b + m\cdot x_i\)</span>
</li>
</ul>
<p>例は、はなびらモデルを使って説明します。</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Petal.Length ~ Petal.Width, data = df_iris0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -0.9842 -0.3043 -0.1043  0.2407  1.2755 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   2.2240     0.1926   11.55   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; Petal.Width   1.6003     0.1114   14.36   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.4709 on 98 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.6779, Adjusted R-squared:  0.6746 </span></span>
<span><span class="co">#&gt; F-statistic: 206.3 on 1 and 98 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<div id="call適用されたモデル" class="section level4" number="21.3.3.1">
<h4>
<span class="header-section-number">21.3.3.1</span> Call（適用されたモデル）<a class="anchor" aria-label="anchor" href="#call%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%81%9F%E3%83%A2%E3%83%87%E3%83%AB"><i class="fas fa-link"></i></a>
</h4>
<p>使われたモデルの定義式（The function and the parameters used to create the model）</p>
</div>
<div id="residuals残差" class="section level4" number="21.3.3.2">
<h4>
<span class="header-section-number">21.3.3.2</span> Residuals（残差）<a class="anchor" aria-label="anchor" href="#residuals%E6%AE%8B%E5%B7%AE"><i class="fas fa-link"></i></a>
</h4>
<p>残差は、実際の値から、予測値を差し引いた値（Difference between what the model predicted and the actual value of y）：<span class="math inline">\(e_i = y_i - \hat{y}_i\)</span></p>
<p>その、分布の、最小値、第一四分位、中央値、第三四分位、最大値が表示されています。次のようにしても、表示できます。</p>
<p>Tidymodels に含まれる、<code>broom</code> パッケージの <code>augument()</code> 関数を使うと、予測値 predicted values (pred) または、fitted values は、.fitted 列に、残差 residues は、.resid に追加されます。（他の列については、さしあたって不要ですが、Help などを参照してください。）</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">augment</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Petal.Length"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Petal.Width"],"name":[2],"type":["dbl"],"align":["right"]},{"label":[".fitted"],"name":[3],"type":["dbl"],"align":["right"]},{"label":[".resid"],"name":[4],"type":["dbl"],"align":["right"]},{"label":[".hat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":[".sigma"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".cooksd"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".std.resid"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"4.7","2":"1.4","3":"4.464330","4":"0.235670459","5":"0.01426460","6":"0.4727384","7":"1.838249e-03","8":"0.504042955"},{"1":"4.5","2":"1.5","3":"4.624355","4":"-0.124355070","5":"0.01173415","6":"0.4731820","7":"4.188765e-04","8":"-0.265625142"},{"1":"4.9","2":"1.5","3":"4.624355","4":"0.275644930","5":"0.01173415","6":"0.4725144","7":"2.058065e-03","8":"0.588783584"},{"1":"4.0","2":"1.3","3":"4.304304","4":"-0.304304013","5":"0.01791473","6":"0.4723245","7":"3.877772e-03","8":"-0.652042132"},{"1":"4.6","2":"1.5","3":"4.624355","4":"-0.024355070","5":"0.01173415","6":"0.4733459","7":"1.606711e-05","8":"-0.052022961"},{"1":"4.5","2":"1.3","3":"4.304304","4":"0.195695987","5":"0.01791473","6":"0.4729276","7":"1.603728e-03","8":"0.419324173"},{"1":"4.7","2":"1.6","3":"4.784381","4":"-0.084380598","5":"0.01032336","6":"0.4732741","7":"1.691901e-04","8":"-0.180110288"},{"1":"3.3","2":"1.0","3":"3.824227","4":"-0.524227427","5":"0.03558312","6":"0.4702391","7":"2.370332e-02","8":"-1.133521906"},{"1":"4.6","2":"1.3","3":"4.304304","4":"0.295695987","5":"0.01791473","6":"0.4723819","7":"3.661489e-03","8":"0.633597434"},{"1":"3.9","2":"1.4","3":"4.464330","4":"-0.564329541","5":"0.01426460","6":"0.4698211","7":"1.054046e-02","8":"-1.206966420"},{"1":"3.5","2":"1.0","3":"3.824227","4":"-0.324227427","5":"0.03558312","6":"0.4721639","7":"9.067115e-03","8":"-0.701067652"},{"1":"4.2","2":"1.5","3":"4.624355","4":"-0.424355070","5":"0.01173415","6":"0.4713640","7":"4.877731e-03","8":"-0.906431686"},{"1":"4.0","2":"1.0","3":"3.824227","4":"0.175772573","5":"0.03558312","6":"0.4730034","7":"2.664844e-03","8":"0.380067984"},{"1":"4.7","2":"1.4","3":"4.464330","4":"0.235670459","5":"0.01426460","6":"0.4727384","7":"1.838249e-03","8":"0.504042955"},{"1":"3.6","2":"1.3","3":"4.304304","4":"-0.704304013","5":"0.01791473","6":"0.4678198","7":"2.077243e-02","8":"-1.509135176"},{"1":"4.4","2":"1.4","3":"4.464330","4":"-0.064329541","5":"0.01426460","6":"0.4733067","7":"1.369667e-04","8":"-0.137585560"},{"1":"4.5","2":"1.5","3":"4.624355","4":"-0.124355070","5":"0.01173415","6":"0.4731820","7":"4.188765e-04","8":"-0.265625142"},{"1":"4.1","2":"1.0","3":"3.824227","4":"0.275772573","5":"0.03558312","6":"0.4724929","7":"6.559516e-03","8":"0.596295111"},{"1":"4.5","2":"1.5","3":"4.624355","4":"-0.124355070","5":"0.01173415","6":"0.4731820","7":"4.188765e-04","8":"-0.265625142"},{"1":"3.9","2":"1.1","3":"3.984253","4":"-0.084252956","5":"0.02857399","6":"0.4732728","7":"4.845927e-04","8":"-0.181519322"},{"1":"4.8","2":"1.8","3":"5.104432","4":"-0.304431655","5":"0.01086080","6":"0.4723310","7":"2.319433e-03","8":"-0.649985520"},{"1":"4.0","2":"1.3","3":"4.304304","4":"-0.304304013","5":"0.01791473","6":"0.4723245","7":"3.877772e-03","8":"-0.652042132"},{"1":"4.9","2":"1.5","3":"4.624355","4":"0.275644930","5":"0.01173415","6":"0.4725144","7":"2.058065e-03","8":"0.588783584"},{"1":"4.7","2":"1.2","3":"4.144278","4":"0.555721516","5":"0.02268452","6":"0.4698987","7":"1.653597e-02","8":"1.193664840"},{"1":"4.3","2":"1.3","3":"4.304304","4":"-0.004304013","5":"0.01791473","6":"0.4733522","7":"7.757362e-07","8":"-0.009222349"},{"1":"4.4","2":"1.4","3":"4.464330","4":"-0.064329541","5":"0.01426460","6":"0.4733067","7":"1.369667e-04","8":"-0.137585560"},{"1":"4.8","2":"1.4","3":"4.464330","4":"0.335670459","5":"0.01426460","6":"0.4721060","7":"3.729240e-03","8":"0.717919127"},{"1":"5.0","2":"1.7","3":"4.944406","4":"0.055593873","5":"0.01003225","6":"0.4733184","7":"7.132883e-05","8":"0.118647608"},{"1":"4.5","2":"1.5","3":"4.624355","4":"-0.124355070","5":"0.01173415","6":"0.4731820","7":"4.188765e-04","8":"-0.265625142"},{"1":"3.5","2":"1.0","3":"3.824227","4":"-0.324227427","5":"0.03558312","6":"0.4721639","7":"9.067115e-03","8":"-0.701067652"},{"1":"3.8","2":"1.1","3":"3.984253","4":"-0.184252956","5":"0.02857399","6":"0.4729717","7":"2.317584e-03","8":"-0.396964964"},{"1":"3.7","2":"1.0","3":"3.824227","4":"-0.124227427","5":"0.03558312","6":"0.4731781","7":"1.331081e-03","8":"-0.268613397"},{"1":"3.9","2":"1.2","3":"4.144278","4":"-0.244278484","5":"0.02268452","6":"0.4726871","7":"3.195109e-03","8":"-0.524699206"},{"1":"5.1","2":"1.6","3":"4.784381","4":"0.315619402","5":"0.01032336","6":"0.4722550","7":"2.367102e-03","8":"0.673689241"},{"1":"4.5","2":"1.5","3":"4.624355","4":"-0.124355070","5":"0.01173415","6":"0.4731820","7":"4.188765e-04","8":"-0.265625142"},{"1":"4.5","2":"1.6","3":"4.784381","4":"-0.284380598","5":"0.01032336","6":"0.4724617","7":"1.921718e-03","8":"-0.607010052"},{"1":"4.7","2":"1.5","3":"4.624355","4":"0.075644930","5":"0.01173415","6":"0.4732894","7":"1.549954e-04","8":"0.161579221"},{"1":"4.4","2":"1.3","3":"4.304304","4":"0.095695987","5":"0.01791473","6":"0.4732509","7":"3.834903e-04","8":"0.205050912"},{"1":"4.1","2":"1.3","3":"4.304304","4":"-0.204304013","5":"0.01791473","6":"0.4728894","7":"1.747917e-03","8":"-0.437768871"},{"1":"4.0","2":"1.3","3":"4.304304","4":"-0.304304013","5":"0.01791473","6":"0.4723245","7":"3.877772e-03","8":"-0.652042132"},{"1":"4.4","2":"1.2","3":"4.144278","4":"0.255721516","5":"0.02268452","6":"0.4726232","7":"3.501465e-03","8":"0.549278323"},{"1":"4.6","2":"1.4","3":"4.464330","4":"0.135670459","5":"0.01426460","6":"0.4731490","7":"6.092067e-04","8":"0.290166783"},{"1":"4.0","2":"1.2","3":"4.144278","4":"-0.144278484","5":"0.02268452","6":"0.4731204","7":"1.114598e-03","8":"-0.309903700"},{"1":"3.3","2":"1.0","3":"3.824227","4":"-0.524227427","5":"0.03558312","6":"0.4702391","7":"2.370332e-02","8":"-1.133521906"},{"1":"4.2","2":"1.3","3":"4.304304","4":"-0.104304013","5":"0.01791473","6":"0.4732318","7":"4.555845e-04","8":"-0.223495610"},{"1":"4.2","2":"1.2","3":"4.144278","4":"0.055721516","5":"0.02268452","6":"0.4733178","7":"1.662498e-04","8":"0.119687311"},{"1":"4.2","2":"1.3","3":"4.304304","4":"-0.104304013","5":"0.01791473","6":"0.4732318","7":"4.555845e-04","8":"-0.223495610"},{"1":"4.3","2":"1.3","3":"4.304304","4":"-0.004304013","5":"0.01791473","6":"0.4733522","7":"7.757362e-07","8":"-0.009222349"},{"1":"3.0","2":"1.1","3":"3.984253","4":"-0.984252956","5":"0.02857399","6":"0.4623652","7":"6.613327e-02","8":"-2.120530103"},{"1":"4.1","2":"1.3","3":"4.304304","4":"-0.204304013","5":"0.01791473","6":"0.4728894","7":"1.747917e-03","8":"-0.437768871"},{"1":"6.0","2":"2.5","3":"6.224610","4":"-0.224610355","5":"0.04801147","6":"0.4727750","7":"6.025544e-03","8":"-0.488828472"},{"1":"5.1","2":"1.9","3":"5.264457","4":"-0.164457184","5":"0.01280903","6":"0.4730540","7":"8.014468e-04","8":"-0.351475324"},{"1":"5.9","2":"2.1","3":"5.584508","4":"0.315491759","5":"0.02006449","6":"0.4722450","7":"4.688829e-03","8":"0.676755589"},{"1":"5.6","2":"1.8","3":"5.104432","4":"0.495568345","5":"0.01086080","6":"0.4706409","7":"6.146238e-03","8":"1.058077379"},{"1":"5.8","2":"2.2","3":"5.744534","4":"0.055466231","5":"0.02537173","6":"0.4733180","7":"1.852612e-04","8":"0.119303101"},{"1":"6.6","2":"2.1","3":"5.584508","4":"1.015491759","5":"0.02006449","6":"0.4617506","7":"4.857817e-02","8":"2.178312758"},{"1":"4.5","2":"1.7","3":"4.944406","4":"-0.444406127","5":"0.01003225","6":"0.4711749","7":"4.557969e-03","8":"-0.948444871"},{"1":"6.3","2":"1.8","3":"5.104432","4":"1.195568345","5":"0.01086080","6":"0.4573454","7":"3.577265e-02","8":"2.552632416"},{"1":"5.8","2":"1.8","3":"5.104432","4":"0.695568345","5":"0.01086080","6":"0.4679957","7":"1.210826e-02","8":"1.485093104"},{"1":"6.1","2":"2.5","3":"6.224610","4":"-0.124610355","5":"0.04801147","6":"0.4731748","7":"1.854577e-03","8":"-0.271194484"},{"1":"5.1","2":"2.0","3":"5.424483","4":"-0.324482712","5":"0.01587693","6":"0.4721859","7":"3.891400e-03","8":"-0.694559467"},{"1":"5.3","2":"1.9","3":"5.264457","4":"0.035542816","5":"0.01280903","6":"0.4733385","7":"3.743456e-05","8":"0.075961552"},{"1":"5.5","2":"2.1","3":"5.584508","4":"-0.084508241","5":"0.02006449","6":"0.4732730","7":"3.364236e-04","8":"-0.181277078"},{"1":"5.0","2":"2.0","3":"5.424483","4":"-0.424482712","5":"0.01587693","6":"0.4713544","7":"6.659517e-03","8":"-0.908610767"},{"1":"5.1","2":"2.4","3":"6.064585","4":"-0.964584826","5":"0.03934522","6":"0.4626853","7":"8.943206e-02","8":"-2.089774039"},{"1":"5.3","2":"2.3","3":"5.904559","4":"-0.604559298","5":"0.03179864","6":"0.4692236","7":"2.795182e-02","8":"-1.304663880"},{"1":"5.5","2":"1.8","3":"5.104432","4":"0.395568345","5":"0.01086080","6":"0.4716266","7":"3.916024e-03","8":"0.844569517"},{"1":"6.7","2":"2.2","3":"5.744534","4":"0.955466231","5":"0.02537173","6":"0.4630400","7":"5.497407e-02","8":"2.055125836"},{"1":"6.9","2":"2.3","3":"5.904559","4":"0.995440702","5":"0.03179864","6":"0.4620731","7":"7.578148e-02","8":"2.148202060"},{"1":"5.0","2":"1.5","3":"4.624355","4":"0.375644930","5":"0.01173415","6":"0.4717950","7":"3.822206e-03","8":"0.802385765"},{"1":"5.7","2":"2.3","3":"5.904559","4":"-0.204559298","5":"0.03179864","6":"0.4728815","7":"3.200153e-03","8":"-0.441447395"},{"1":"4.9","2":"2.0","3":"5.424483","4":"-0.524482712","5":"0.01587693","6":"0.4702987","7":"1.016682e-02","8":"-1.122662068"},{"1":"6.7","2":"2.0","3":"5.424483","4":"1.275517288","5":"0.01587693","6":"0.4549937","7":"6.013059e-02","8":"2.730261346"},{"1":"4.9","2":"1.8","3":"5.104432","4":"-0.204431655","5":"0.01086080","6":"0.4728921","7":"1.045920e-03","8":"-0.436477657"},{"1":"5.7","2":"2.1","3":"5.584508","4":"0.115491759","5":"0.02006449","6":"0.4732042","7":"6.283337e-04","8":"0.247739256"},{"1":"6.0","2":"1.8","3":"5.104432","4":"0.895568345","5":"0.01086080","6":"0.4644386","7":"2.007242e-02","8":"1.912108829"},{"1":"4.8","2":"1.8","3":"5.104432","4":"-0.304431655","5":"0.01086080","6":"0.4723310","7":"2.319433e-03","8":"-0.649985520"},{"1":"4.9","2":"1.8","3":"5.104432","4":"-0.204431655","5":"0.01086080","6":"0.4728921","7":"1.045920e-03","8":"-0.436477657"},{"1":"5.6","2":"2.1","3":"5.584508","4":"0.015491759","5":"0.02006449","6":"0.4733497","7":"1.130550e-05","8":"0.033231089"},{"1":"5.8","2":"1.6","3":"4.784381","4":"1.015619402","5":"0.01032336","6":"0.4618633","7":"2.451047e-02","8":"2.167838415"},{"1":"6.1","2":"1.9","3":"5.264457","4":"0.835542816","5":"0.01280903","6":"0.4655877","7":"2.068743e-02","8":"1.785709056"},{"1":"6.4","2":"2.0","3":"5.424483","4":"0.975517288","5":"0.01587693","6":"0.4627025","7":"3.517165e-02","8":"2.088107444"},{"1":"5.6","2":"2.2","3":"5.744534","4":"-0.144533769","5":"0.02537173","6":"0.4731189","7":"1.257957e-03","8":"-0.310879729"},{"1":"5.1","2":"1.5","3":"4.624355","4":"0.475644930","5":"0.01173415","6":"0.4708529","7":"6.128085e-03","8":"1.015987946"},{"1":"5.6","2":"1.4","3":"4.464330","4":"1.135670459","5":"0.01426460","6":"0.4588831","7":"4.268730e-02","8":"2.428928502"},{"1":"6.1","2":"2.3","3":"5.904559","4":"0.195440702","5":"0.03179864","6":"0.4729226","7":"2.921207e-03","8":"0.421769090"},{"1":"5.6","2":"2.4","3":"6.064585","4":"-0.464584826","5":"0.03934522","6":"0.4708994","7":"2.074639e-02","8":"-1.006523514"},{"1":"5.5","2":"1.8","3":"5.104432","4":"0.395568345","5":"0.01086080","6":"0.4716266","7":"3.916024e-03","8":"0.844569517"},{"1":"4.8","2":"1.8","3":"5.104432","4":"-0.304431655","5":"0.01086080","6":"0.4723310","7":"2.319433e-03","8":"-0.649985520"},{"1":"5.4","2":"2.1","3":"5.584508","4":"-0.184508241","5":"0.02006449","6":"0.4729739","7":"1.603688e-03","8":"-0.395785245"},{"1":"5.6","2":"2.4","3":"6.064585","4":"-0.464584826","5":"0.03934522","6":"0.4708994","7":"2.074639e-02","8":"-1.006523514"},{"1":"5.1","2":"2.3","3":"5.904559","4":"-0.804559298","5":"0.03179864","6":"0.4660150","7":"4.950493e-02","8":"-1.736272122"},{"1":"5.1","2":"1.9","3":"5.264457","4":"-0.164457184","5":"0.01280903","6":"0.4730540","7":"8.014468e-04","8":"-0.351475324"},{"1":"5.9","2":"2.3","3":"5.904559","4":"-0.004559298","5":"0.03179864","6":"0.4733522","7":"1.589748e-06","8":"-0.009839152"},{"1":"5.7","2":"2.5","3":"6.224610","4":"-0.524610355","5":"0.04801147","6":"0.4701937","7":"3.287081e-02","8":"-1.141730435"},{"1":"5.2","2":"2.3","3":"5.904559","4":"-0.704559298","5":"0.03179864","6":"0.4677359","7":"3.796360e-02","8":"-1.520468001"},{"1":"5.0","2":"1.9","3":"5.264457","4":"-0.264457184","5":"0.01280903","6":"0.4725803","7":"2.072429e-03","8":"-0.565193762"},{"1":"5.2","2":"2.0","3":"5.424483","4":"-0.224482712","5":"0.01587693","6":"0.4727945","7":"1.862467e-03","8":"-0.480508166"},{"1":"5.4","2":"2.3","3":"5.904559","4":"-0.504559298","5":"0.03179864","6":"0.4704804","7":"1.946959e-02","8":"-1.088859759"},{"1":"5.1","2":"1.8","3":"5.104432","4":"-0.004431655","5":"0.01086080","6":"0.4733522","7":"4.915121e-07","8":"-0.009461933"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>したがってそれを使えば、Residuals の部分の値は、次のようにして得られます。</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">augment</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">.resid</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt; -0.9843 -0.3043 -0.1043  0.0000  0.2407  1.2755</span></span></code></pre></div>
</div>
<div id="数式による定義" class="section level4" number="21.3.3.3">
<h4>
<span class="header-section-number">21.3.3.3</span> 数式による定義<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E5%BC%8F%E3%81%AB%E3%82%88%E3%82%8B%E5%AE%9A%E7%BE%A9"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
\begin{aligned}
\mbox{$x$ の平均：} mean(x) &amp; = \frac{1}{n}\sum_i x_i \\
\mbox{$y$ の平均：} mean(y) &amp; = \frac{1}{n}\sum_i y_i \\
\mbox{$x$ の分散：} var(x) &amp; = \frac{1}{n}\sum_i(x_i-mean(x))^2 \\
\mbox{$y$ の分散：} var(y) &amp; = \frac{1}{n}\sum_i(y_i-mean(y))^2 \\
\mbox{$x$ と $y$ の共分散：} cov(x) &amp; = \frac{1}{n}\sum_i(x_i-mean(x))(y_i-mean(y)) \\
\mbox{$x$ と $y$ の相関係数：} cor(x) &amp; = \frac{cov(x,y)}{\sqrt{var(x)}\sqrt{var(y)}}\\
\mbox{回帰直線の係数： slope}  &amp;= \frac{cov(x,y)}{var(x)} = \frac{cor(x,y)\sqrt{var(y)}}{\sqrt{var(x)}}\\
\mbox{全平方和 total sum of squares：} &amp;SS_{tot} = \sum_{i}(y_i-mean(y))^2\\
\mbox{残差平方和 residual sum of squares：} &amp;SS_{res} = \sum_{i}(y_i-\mbox{pred}_i)^2 \\ &amp;= \sum_{i}(y_i-\hat{y}_i)^2\\
\mbox{決定係数 R squared：} R^2 &amp; = 1 - \frac{SS_{res}}{SS_{tot}} = cor(x,y)^2
\end{aligned}
\]</span></p>
</div>
<div id="adjusted-r-squared自由度修正済み決定係数" class="section level4" number="21.3.3.4">
<h4>
<span class="header-section-number">21.3.3.4</span> Adjusted R Squared（自由度修正済み決定係数）<a class="anchor" aria-label="anchor" href="#adjusted-r-squared%E8%87%AA%E7%94%B1%E5%BA%A6%E4%BF%AE%E6%AD%A3%E6%B8%88%E3%81%BF%E6%B1%BA%E5%AE%9A%E4%BF%82%E6%95%B0"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[\text{Adjusted }R^2 = 1- \frac{(1-R^2)(n-1)}{n-k-1}\]</span> <span class="math inline">\(n\)</span>: 行数（観測値の数）number of observations, the number of rows</p>
<p><span class="math inline">\(k\)</span>: number of variables used for prediction</p>
</div>
<div id="coefficients係数" class="section level4" number="21.3.3.5">
<h4>
<span class="header-section-number">21.3.3.5</span> Coefficients（係数）<a class="anchor" aria-label="anchor" href="#coefficients%E4%BF%82%E6%95%B0"><i class="fas fa-link"></i></a>
</h4>
<p>Tidymodels に含まれる、<code>broom</code> パッケージの <code>tody()</code> 関数を使うと、係数の部分を表として取り出すことができます。</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">tidy</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"2.223972","3":"0.1925967","4":"11.54730","5":"5.539853e-20"},{"1":"Petal.Width","2":"1.600255","3":"0.1114263","4":"14.36156","5":"7.569332e-26"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>ここに現れる、statistics は t-検定の、値で、p.value が最初に定めた値、たとえば、0.05よりも、小さければ、Intercept や、Petal.Width の係数が、0 である確率は非常に小さいといいます。</p>
</div>
<div id="other-model-summariesその他のモデル概要" class="section level4" number="21.3.3.6">
<h4>
<span class="header-section-number">21.3.3.6</span> Other Model Summaries（その他のモデル概要）<a class="anchor" aria-label="anchor" href="#other-model-summaries%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E6%A6%82%E8%A6%81"><i class="fas fa-link"></i></a>
</h4>
<p>Tidymodels に含まれる、<code>broom</code> パッケージの <code>glance()</code> 関数を使うと、残りの値が表示できます。</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["r.squared"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[11],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[12],"type":["int"],"align":["right"]}],"data":[{"1":"0.6779013","2":"0.6746145","3":"0.4709312","4":"206.2545","5":"7.569332e-26","6":"1","7":"-65.57938","8":"137.1588","9":"144.9743","10":"21.73406","11":"98","12":"100"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>r.squared は、R squared（決定係数）、adj.r.squared は、Adjusted R Squared（自由度修正済み決定係数）、sigma は、Residual Standard Error（残差標準誤差）、statistic は、f 検定の F value（F 値）、p.value は、F 分布の p値です。</p>
<p>最初の2つはすでに説明しました。</p>
<p><span class="math display">\[
\mbox{statistic} = \frac{SS_{tot} - SS_{res}}{SS_{res}}\cdot \frac{n-(k+1)}{k}
\]</span></p>
<p>p値が、定めた値、例えば、0.05 より小さいと、2つの変数が、関係しない確率が非常に小さいということになります。</p>
<p>Correlation Constant （相関係数）</p>
<p>式に現れるように、<span class="math inline">\(R^2 = cor(x,y)^2\)</span>　でしたから、相関係数が分かれば、この場合の決定係数はわかることになります。特に、相関係数の大きな変数の対を見つければ、それから計算する、線形モデルは、強いモデルだということになります。</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000   0.5538548    0.8284787</span></span>
<span><span class="co">#&gt; Sepal.Width     0.5538548   1.0000000    0.5198023</span></span>
<span><span class="co">#&gt; Petal.Length    0.8284787   0.5198023    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.5937094   0.5662025    0.8233476</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.5937094</span></span>
<span><span class="co">#&gt; Sepal.Width    0.5662025</span></span>
<span><span class="co">#&gt; Petal.Length   0.8233476</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<p>その自乗を計算することもできます。</p>
<p>この例では、Sepal.Length と、Petal.Length の相関が最も強いことがわかります。</p>
<p>select(1:4) で、最初の四列を取り出していますが、iris のデータは、五つの変数（五列）で五番目は、Species（種類）でしたから、Species の列以外という意味です。すこで、下では、select(-5) としています。どちらでも同じです。Species は、文字列で種類が書かれていましたから、相関係数を求めようとすると、エラーになります。</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cormat</span> <span class="op">&lt;-</span> <span class="va">df_iris0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cormat</span><span class="op">*</span><span class="va">cormat</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000   0.3067552    0.6863769</span></span>
<span><span class="co">#&gt; Sepal.Width     0.3067552   1.0000000    0.2701944</span></span>
<span><span class="co">#&gt; Petal.Length    0.6863769   0.2701944    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.3524909   0.3205853    0.6779013</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.3524909</span></span>
<span><span class="co">#&gt; Sepal.Width    0.3205853</span></span>
<span><span class="co">#&gt; Petal.Length   0.6779013</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html">iris</a></span></span></code></pre></div>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000   0.7425467    0.2671758</span></span>
<span><span class="co">#&gt; Sepal.Width     0.7425467   1.0000000    0.1777000</span></span>
<span><span class="co">#&gt; Petal.Length    0.2671758   0.1777000    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.2780984   0.2327520    0.3316300</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.2780984</span></span>
<span><span class="co">#&gt; Sepal.Width    0.2327520</span></span>
<span><span class="co">#&gt; Petal.Length   0.3316300</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000   0.4572278    0.8642247</span></span>
<span><span class="co">#&gt; Sepal.Width     0.4572278   1.0000000    0.4010446</span></span>
<span><span class="co">#&gt; Petal.Length    0.8642247   0.4010446    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.2811077   0.5377280    0.3221082</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.2811077</span></span>
<span><span class="co">#&gt; Sepal.Width    0.5377280</span></span>
<span><span class="co">#&gt; Petal.Length   0.3221082</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"versicolor"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000   0.5259107    0.7540490</span></span>
<span><span class="co">#&gt; Sepal.Width     0.5259107   1.0000000    0.5605221</span></span>
<span><span class="co">#&gt; Petal.Length    0.7540490   0.5605221    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.5464611   0.6639987    0.7866681</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.5464611</span></span>
<span><span class="co">#&gt; Sepal.Width    0.6639987</span></span>
<span><span class="co">#&gt; Petal.Length   0.7866681</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-32-1.png" width="672"></div>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">glance</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8642247</span></span></code></pre></div>
<p>2つの変数の場合には、このように、相関係数を見てみることも、大切です。Correlations of the data suggest the possible strength of linear model y ~ x.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Sepal.Length Sepal.Width Petal.Length</span></span>
<span><span class="co">#&gt; Sepal.Length    1.0000000  -0.1175698    0.8717538</span></span>
<span><span class="co">#&gt; Sepal.Width    -0.1175698   1.0000000   -0.4284401</span></span>
<span><span class="co">#&gt; Petal.Length    0.8717538  -0.4284401    1.0000000</span></span>
<span><span class="co">#&gt; Petal.Width     0.8179411  -0.3661259    0.9628654</span></span>
<span><span class="co">#&gt;              Petal.Width</span></span>
<span><span class="co">#&gt; Sepal.Length   0.8179411</span></span>
<span><span class="co">#&gt; Sepal.Width   -0.3661259</span></span>
<span><span class="co">#&gt; Petal.Length   0.9628654</span></span>
<span><span class="co">#&gt; Petal.Width    1.0000000</span></span></code></pre></div>
<p>最後に、もう一つ、iris の例を描いておきます。</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span>, formula <span class="op">=</span> <span class="st">"y~x"</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="st">"y~x"</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-35-1.png" width="672"></div>
<p>点線は、全体の、がくモデルについての、回帰直線です。どのようなことがわかりますか。</p>
<ul>
<li><p>三つの種別ごとで見ると、回帰直線は、右肩上がり、すなわち、萼（がく）幅が大きくなると、萼長が大きくなっている。</p></li>
<li><p>全体で見ると、回帰直線は、右肩下がり、すなわち、萼（がく）幅が大きくなると、萼長が小さくなっている。</p></li>
</ul>
<p>最初に、同じ種類のあやめ（iris）では、おそらく、萼の形などは相似（似た形をしている）だろうから、「萼（がく）幅が大きくなると、萼長が大きくなっていると予想される」と書きました。しかし、上のグラフからみると、これら三種類のあやめ全体ではそうなっておらず、三種類個別にみると、予想のようになっていることがわかります。</p>
<p>この場合、Species が交絡因子（confounder）になっていると言います。</p>
</div>
<div id="chatgpt-への質問と回答" class="section level4" number="21.3.3.7">
<h4>
<span class="header-section-number">21.3.3.7</span> ChatGPT への質問と回答<a class="anchor" aria-label="anchor" href="#chatgpt-%E3%81%B8%E3%81%AE%E8%B3%AA%E5%95%8F%E3%81%A8%E5%9B%9E%E7%AD%94"><i class="fas fa-link"></i></a>
</h4>
<blockquote>
<p><strong>Q.</strong> 交絡因子、confounder について、説明してください。<br>
iris の data で、Sepal.Width と Sepal.Length でみると、負の相関になっている、または、回帰直線の傾きが負になっているが、各 Species ごとにみると、傾きが正になっている。この場合も、Species が交絡因子になっていると言えますか。</p>
</blockquote>
<p><strong>ChatGPT</strong> (2023.9.19)</p>
<p>交絡因子（confounder）は、2つ以上の変数間の関係を誤解させる要因であり、研究結果に偏りをもたらす可能性がある変数です。交絡因子は、主な関心事（たとえば、Sepal.WidthとSepal.Lengthの関係）と関係がある可能性があり、その関係を調べる際に考慮する必要があります。</p>
<p>IrisデータセットでSepal.WidthとSepal.Lengthの関係を見た場合、負の相関が観察されるか、回帰直線の傾きが負になるかもしれません。しかし、各Speciesごとに見た場合、傾きが正になることが示唆されています。</p>
<p>この場合、Speciesが交絡因子である可能性があります。なぜなら、SpeciesはSepal.WidthとSepal.Lengthの間の関係に影響を与えている可能性があります。例えば、異なる種のアイリスの場合、Sepal.WidthとSepal.Lengthの間の関係が異なるかもしれません。したがって、交絡因子としてSpeciesを考慮しないと、Sepal.WidthとSepal.Lengthの間の関係を適切に解釈することができません。</p>
<p>交絡因子を適切に扱うためには、統計的な手法や分析手法を用いて、交絡因子を制御する必要があります。例えば、多変量解析や回帰分析において、Speciesを説明変数としてモデルに含めることができます。そうすることで、Speciesの効果を考慮したSepal.WidthとSepal.Lengthの関係をより正確に評価できます。</p>
<p>したがって、交絡因子としてSpeciesを考慮することは重要です。それにより、変数間の関係をより正確に理解し、結果の解釈に偏りが生じないようにすることができます。</p>
</div>
</div>
</div>
<div id="世界開発指標wdiからの例" class="section level2" number="21.4">
<h2>
<span class="header-section-number">21.4</span> 世界開発指標（WDI）からの例<a class="anchor" aria-label="anchor" href="#%E4%B8%96%E7%95%8C%E9%96%8B%E7%99%BA%E6%8C%87%E6%A8%99wdi%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B"><i class="fas fa-link"></i></a>
</h2>
<div id="出生時の平均寿命life-expectancy-at-birth" class="section level3" number="21.4.1">
<h3>
<span class="header-section-number">21.4.1</span> 出生時の平均寿命（life expectancy at birth）<a class="anchor" aria-label="anchor" href="#%E5%87%BA%E7%94%9F%E6%99%82%E3%81%AE%E5%B9%B3%E5%9D%87%E5%AF%BF%E5%91%BDlife-expectancy-at-birth"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>SP.DYN.LE00.IN: Life expectancy at birth, total (years)</li>
</ul>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vincentarelbundock.github.io/WDI/reference/WDI.html">WDI</a></span><span class="op">(</span>indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="st">"SP.DYN.LE00.IN"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Rows: 16758 Columns: 5
#&gt; ── Column specification ────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr (3): country, iso2c, iso3c
#&gt; dbl (2): year, lifeExp
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"World"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-39-1.png" width="672"></div>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = lifeExp ~ year, data = wdi_lifeExp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -51.173  -7.150   1.741   7.794  18.782 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -5.383e+02  8.583e+00  -62.71   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; year         3.027e-01  4.312e-03   70.20   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 9.707 on 15864 degrees of freedom</span></span>
<span><span class="co">#&gt;   (892 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.237,  Adjusted R-squared:  0.237 </span></span>
<span><span class="co">#&gt; F-statistic:  4928 on 1 and 15864 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p><span class="math display">\[lifeExp \sim -538.3 + 0.3027 \cdot year\]</span></p>
<p>世界の平均寿命は、毎年、ほぼ、0.3年ほど増加しているという傾向にあるということのようです。ただ、適合度は、0.237 ですから、あまり良くはありません。これを使って、将来について予測するのは、適切ではないかもしれません。</p>
<p>Each year, life expectancy at birth increases approximately 0.3 years. R-squared of this model is 0.237, and the model explains 24%.</p>
<p>しかしグラフをみると、1960年ごろと、1920年以降は、ちょっと違った動きをしています。これを、除くと、ほぼ一直線上にあるように見えます。年を 1962年から、2019年までに、制限してみてみましょう。</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"World"</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">1962</span>, <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2019</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">year</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = lifeExp ~ year, data = .)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -1.00776 -0.29546 -0.04527  0.37540  0.82117 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -5.537e+02  7.841e+00  -70.62   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; year         3.107e-01  3.939e-03   78.89   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.5022 on 56 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.9911, Adjusted R-squared:  0.9909 </span></span>
<span><span class="co">#&gt; F-statistic:  6224 on 1 and 56 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>今度は、決定係数が 0.9911 になりました。グラフをみた直感とあっていますね。ですから、1962年から、2019年までの間は、世界の出生時平均寿命は、毎年、0.31 年ほどずつ増加していると結論することができそうです。</p>
<p>実際には、調査対象の国がどのように変化しているかなど、他の要因も調べる必要があると思います。</p>
<p>また、なぜ、1960年から、1962年は、大きく変化しているのか、2020年で減少している理由はなんだろうか。コロナウイルス感染症のせいだろうかなど、考えることが広がっていくかもしれません。次々と新しい問いが出てくること。それが素晴らしいことです。ほんの少しわかったことによって、扉が開いていく。そのような経験をたくさんしていただきたいと思います。</p>
</div>
<div id="brics-の出生時" class="section level3" number="21.4.2">
<h3>
<span class="header-section-number">21.4.2</span> BRICS の出生時<a class="anchor" aria-label="anchor" href="#brics-%E3%81%AE%E5%87%BA%E7%94%9F%E6%99%82"><i class="fas fa-link"></i></a>
</h3>
<p>今度は、BRICS についてみてみましょう。最初は、BRIC または、BRICs と、４カ国で、ブラジル、ロシア、インド、中国を指していましたが、南アフリカが急成長したこともあり、南アフリカを加えて、現在は、BRICS と言っているようです。2023 年の首脳会議で、さらに、６カ国（アルゼンチン、エジプト、エチオピア、イラン、サウジアラビア、アラブ首長国連邦）が加わって、かなり大きな勢力となりつつあるようです。どのぐらいの規模なのか、GDP（国内総生産）、Population（人口）、Oil Production（原油生成量）、Exports of Goods （製品輸出）などが世界のどの程度をしめるのかも、そして、これらの指標の増加・または減少の傾向などについても、調べてみると良いかもしれませんね。</p>
<p>決定係数を求めてみましょう。下から、0.47 ですから、まあまあです。</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_brics</span> <span class="op">&lt;-</span> <span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Brazil"</span>, <span class="st">"Russian Federation"</span>, <span class="st">"India"</span>, <span class="st">"China"</span>, <span class="st">"South Africa"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod_brics</span><span class="op">$</span><span class="va">r.squared</span></span>
<span><span class="co">#&gt; [1] 0.4717945</span></span></code></pre></div>
<p>そこで、４カ国の、出生時平均寿命のグラフを描いてみましょう。回帰直線は、データポイント（点）から計算されるものですから、<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> を使った方が良いかもしれませんが、ある程度長い期間の時系列データですから、<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> で、折れ線グラフを書いてみました。<code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> の中にある、<code>color = country</code> を省略するとどうなるでしょうか。ぜひ試してみてください。<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> にかえたグラフも描いてみることをお勧めします。</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Brazil"</span>, <span class="st">"Russian Federation"</span>, <span class="st">"India"</span>, <span class="st">"China"</span>, <span class="st">"South Africa"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>国ごとにかなり異なることもわかりますね。それも、かなりの変化があります。この場合には、いろいろなモデルのさまざまな値をみるよりも、グラフをていねいにみていくことが大切なように思います。</p>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-44-1.png" width="672"></div>
<p>一応、geom_point() に変更し、それぞれの国ごとに、回帰直線を描いたグラフを付けておきます。</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Brazil"</span>, <span class="st">"Russian Federation"</span>, <span class="st">"India"</span>, <span class="st">"China"</span>,<span class="st">"South Africa"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">country</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-modeling_files/figure-html/unnamed-chunk-45-1.png" width="672"></div>
<p>以下では、それぞれの国ごとに、モデルを作成し tidy や、glance で、その、基本的なデータを、取り出して、表にする方法を紹介します。このようにして、一度に、国ごとのモデルの、さまざまな値を求めることができます。結果だけを出力することも可能ですが、ステップごとの状況も確認できるようにしておきます。</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lifeExp</span> <span class="op">~</span> <span class="va">year</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">by_country</span> <span class="op">&lt;-</span> <span class="va">wdi_lifeExp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Brazil"</span>, <span class="st">"Russian Federation"</span>, <span class="st">"India"</span>, <span class="st">"China"</span>,<span class="st">"South Africa"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by_country</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"Brazil","2":"<tibble[,4]>"},{"1":"China","2":"<tibble[,4]>"},{"1":"India","2":"<tibble[,4]>"},{"1":"Russian Federation","2":"<tibble[,4]>"},{"1":"South Africa","2":"<tibble[,4]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_by_country</span> <span class="op">&lt;-</span> <span class="va">by_country</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">country_model</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model_by_country</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["model"],"name":[3],"type":["list"],"align":["right"]}],"data":[{"1":"Brazil","2":"<tibble[,4]>","3":"<S3: lm>"},{"1":"China","2":"<tibble[,4]>","3":"<S3: lm>"},{"1":"India","2":"<tibble[,4]>","3":"<S3: lm>"},{"1":"Russian Federation","2":"<tibble[,4]>","3":"<S3: lm>"},{"1":"South Africa","2":"<tibble[,4]>","3":"<S3: lm>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_by_country</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tidied <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">tidy</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">tidied</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["model"],"name":[3],"type":["list"],"align":["right"]},{"label":["term"],"name":[4],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"Brazil","2":"<tibble[,4]>","3":"<S3: lm>","4":"(Intercept)","5":"-693.85295414","6":"13.159218021","7":"-52.7275217","8":"5.749750e-52"},{"1":"Brazil","2":"<tibble[,4]>","3":"<S3: lm>","4":"year","5":"0.38147526","6":"0.006610744","7":"57.7053430","8":"2.842577e-54"},{"1":"China","2":"<tibble[,4]>","3":"<S3: lm>","4":"(Intercept)","5":"-930.18618645","6":"46.833953383","7":"-19.8613638","8":"4.571028e-28"},{"1":"China","2":"<tibble[,4]>","3":"<S3: lm>","4":"year","5":"0.50075679","6":"0.023527787","7":"21.2836331","8":"1.197665e-29"},{"1":"India","2":"<tibble[,4]>","3":"<S3: lm>","4":"(Intercept)","5":"-844.44232251","6":"12.146942424","7":"-69.5189203","8":"4.690802e-59"},{"1":"India","2":"<tibble[,4]>","3":"<S3: lm>","4":"year","5":"0.45344834","6":"0.006102211","7":"74.3088560","8":"9.007844e-61"},{"1":"Russian Federation","2":"<tibble[,4]>","3":"<S3: lm>","4":"(Intercept)","5":"-7.12070953","6":"26.047357514","7":"-0.2733755","8":"7.855034e-01"},{"1":"Russian Federation","2":"<tibble[,4]>","3":"<S3: lm>","4":"year","5":"0.03773633","6":"0.013085308","7":"2.8838706","8":"5.447164e-03"},{"1":"South Africa","2":"<tibble[,4]>","3":"<S3: lm>","4":"(Intercept)","5":"-187.16885352","6":"45.463887342","7":"-4.1168687","8":"1.191371e-04"},{"1":"South Africa","2":"<tibble[,4]>","3":"<S3: lm>","4":"year","5":"0.12377067","6":"0.022839513","7":"5.4191466","8":"1.118391e-06"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_by_country</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>glanced <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">broom</span><span class="fu">::</span><span class="va"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">glanced</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["country"],"name":[1],"type":["chr"],"align":["left"]},{"label":["data"],"name":[2],"type":["list"],"align":["right"]},{"label":["model"],"name":[3],"type":["list"],"align":["right"]},{"label":["r.squared"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["adj.r.squared"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["sigma"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["df.residual"],"name":[14],"type":["int"],"align":["right"]},{"label":["nobs"],"name":[15],"type":["int"],"align":["right"]}],"data":[{"1":"Brazil","2":"<tibble[,4]>","3":"<S3: lm>","4":"0.9823004","5":"0.9820054","6":"0.9315170","7":"3329.90661","8":"2.842577e-54","9":"1","10":"-82.55937","11":"171.1187","12":"177.5001","13":"52.06343","14":"60","15":"62"},{"1":"China","2":"<tibble[,4]>","3":"<S3: lm>","4":"0.8830393","5":"0.8810900","6":"3.3152898","7":"452.99304","8":"1.197665e-29","9":"1","10":"-161.26750","11":"328.5350","12":"334.9164","13":"659.46880","14":"60","15":"62"},{"1":"India","2":"<tibble[,4]>","3":"<S3: lm>","4":"0.9892508","5":"0.9890716","6":"0.8598598","7":"5521.80609","8":"9.007844e-61","9":"1","10":"-77.59658","11":"161.1932","12":"167.5746","13":"44.36153","14":"60","15":"62"},{"1":"Russian Federation","2":"<tibble[,4]>","3":"<S3: lm>","4":"0.1217376","5":"0.1070999","6":"1.8438448","7":"8.31671","8":"5.447164e-03","9":"1","10":"-124.89259","11":"255.7852","12":"262.1666","13":"203.98581","14":"60","15":"62"},{"1":"South Africa","2":"<tibble[,4]>","3":"<S3: lm>","4":"0.3286124","5":"0.3174226","6":"3.2183054","7":"29.36715","8":"1.118391e-06","9":"1","10":"-159.42671","11":"324.8534","12":"331.2348","13":"621.44936","14":"60","15":"62"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="数理モデルに関する参考文献" class="section level2" number="21.5">
<h2>
<span class="header-section-number">21.5</span> 数理モデルに関する参考文献<a class="anchor" aria-label="anchor" href="#%E6%95%B0%E7%90%86%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Tidy Modeling with R：tidymodel パッケージ群の教科書
<ul>
<li><a href="https://www.tmwr.org" class="uri">https://www.tmwr.org</a></li>
</ul>
</li>
<li>Tidymodels パッケージ群
<ul>
<li><a href="https://www.tidymodels.org" class="uri">https://www.tidymodels.org</a></li>
<li>broom: <a href="https://cran.r-project.org/web/packages/broom/index.html" class="uri">https://cran.r-project.org/web/packages/broom/index.html</a>
</li>
<li>Introduction to broom: <a href="https://cran.r-project.org/web/packages/broom/vignettes/broom.html" class="uri">https://cran.r-project.org/web/packages/broom/vignettes/broom.html</a>
</li>
</ul>
</li>
<li>統計学の時間
<ul>
<li><a href="https://bellcurve.jp/statistics/course/" class="uri">https://bellcurve.jp/statistics/course/</a></li>
</ul>
</li>
</ul>
<div id="モデル概要に現れる数値について" class="section level3" number="21.5.1">
<h3>
<span class="header-section-number">21.5.1</span> モデル概要に現れる数値について<a class="anchor" aria-label="anchor" href="#%E3%83%A2%E3%83%87%E3%83%AB%E6%A6%82%E8%A6%81%E3%81%AB%E7%8F%BE%E3%82%8C%E3%82%8B%E6%95%B0%E5%80%A4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>r-statistics.co by Selva Prabhakaran:
<ul>
<li><a href="http://r-statistics.co/Linear-Regression.html" class="uri">http://r-statistics.co/Linear-Regression.html</a></li>
</ul>
</li>
<li>Meaning Behind Each Section of Summary()
<ul>
<li><a href="https://www.learnbymarketing.com/tutorials/explaining-the-lm-summary-in-r/" class="uri">https://www.learnbymarketing.com/tutorials/explaining-the-lm-summary-in-r/</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="import.html"><span class="header-section-number">20</span> データ読み込み（Import）</a></div>
<div class="next"><a href="communicate.html"><span class="header-section-number">22</span> 情報共有（Communicate）</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#modeling"><span class="header-section-number">21</span> 数理モデル（Modeling）</a></li>
<li><a class="nav-link" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB-4"><span class="header-section-number">21.1</span> はじめに</a></li>
<li><a class="nav-link" href="#%E6%BA%96%E5%82%99setup"><span class="header-section-number">21.2</span> 準備（Setup）</a></li>
<li>
<a class="nav-link" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E5%85%A5%E9%96%80"><span class="header-section-number">21.3</span> 線形モデル入門</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E4%BE%8Blinear-models-by-examples"><span class="header-section-number">21.3.1</span> 線形モデルの例（Linear Models by Examples）</a></li>
<li><a class="nav-link" href="#%E7%B7%9A%E5%BD%A2%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%9F%BA%E7%A4%8Elinear-model-basics-y-x"><span class="header-section-number">21.3.2</span> 線形モデルの基礎（Linear Model Basics）: y ~ x</a></li>
<li><a class="nav-link" href="#%E3%83%A2%E3%83%87%E3%83%AB%E6%A6%82%E8%A6%81"><span class="header-section-number">21.3.3</span> モデル概要</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E4%B8%96%E7%95%8C%E9%96%8B%E7%99%BA%E6%8C%87%E6%A8%99wdi%E3%81%8B%E3%82%89%E3%81%AE%E4%BE%8B"><span class="header-section-number">21.4</span> 世界開発指標（WDI）からの例</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%87%BA%E7%94%9F%E6%99%82%E3%81%AE%E5%B9%B3%E5%9D%87%E5%AF%BF%E5%91%BDlife-expectancy-at-birth"><span class="header-section-number">21.4.1</span> 出生時の平均寿命（life expectancy at birth）</a></li>
<li><a class="nav-link" href="#brics-%E3%81%AE%E5%87%BA%E7%94%9F%E6%99%82"><span class="header-section-number">21.4.2</span> BRICS の出生時</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%95%B0%E7%90%86%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="header-section-number">21.5</span> 数理モデルに関する参考文献</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#%E3%83%A2%E3%83%87%E3%83%AB%E6%A6%82%E8%A6%81%E3%81%AB%E7%8F%BE%E3%82%8C%E3%82%8B%E6%95%B0%E5%80%A4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><span class="header-section-number">21.5.1</span> モデル概要に現れる数値について</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/icu-hsuzuki/ds4aj/blob/master/28-modeling.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/icu-hsuzuki/ds4aj/edit/master/28-modeling.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>データサイエンスをはじめましょう<br>
- Data Science for All -</strong>" was written by 鈴木寛（Hiroshi Suzuki）. It was last built on 2023-09-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
