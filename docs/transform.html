<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 18 変形（Transform） | データサイエンスをはじめましょう - Data Science for All -</title>
<meta name="author" content="鈴木寛（Hiroshi Suzuki）">
<meta name="description" content="ここでは、tidyverse パッケージを構成する dplyr...">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Chapter 18 変形（Transform） | データサイエンスをはじめましょう - Data Science for All -">
<meta property="og:type" content="book">
<meta property="og:url" content="https://icu-hsuzuki.github.io/ds4aj/transform.html">
<meta property="og:description" content="ここでは、tidyverse パッケージを構成する dplyr...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 18 変形（Transform） | データサイエンスをはじめましょう - Data Science for All -">
<meta name="twitter:description" content="ここでは、tidyverse パッケージを構成する dplyr...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">データサイエンスをはじめましょう<br>
- Data Science for All -</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">この文書について</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> はじめに</a></li>
<li><a class="" href="what2learn.html"><span class="header-section-number">2</span> 学ぶ内容　</a></li>
<li><a class="" href="first-example.html"><span class="header-section-number">3</span> はじめてのデータサイエンス</a></li>
<li><a class="" href="wdi-site.html"><span class="header-section-number">4</span> 世界開発指標とオープンデータ</a></li>
<li><a class="" href="notebook.html"><span class="header-section-number">5</span> データサイエンス ノートブック</a></li>
<li class="book-part">第一部 オープンデータ</li>
<li><a class="" href="publicdata-site.html"><span class="header-section-number">6</span> オープンデータ</a></li>
<li><a class="" href="worldbank-site.html"><span class="header-section-number">7</span> 世界銀行（World Bank）</a></li>
<li><a class="" href="oecd-site.html"><span class="header-section-number">8</span> OECD（経済協力開発機構）</a></li>
<li><a class="" href="un-site.html"><span class="header-section-number">9</span> United Nations（国際連合）</a></li>
<li><a class="" href="owid-site.html"><span class="header-section-number">10</span> Our World in Data</a></li>
<li><a class="" href="estat-site.html"><span class="header-section-number">11</span> e-Stat 日本の政府統計</a></li>
<li><a class="" href="sdgs-site.html"><span class="header-section-number">12</span> SDGs</a></li>
<li><a class="" href="other-site.html"><span class="header-section-number">13</span> その他のサイト</a></li>
<li class="book-part">第二部 R の基礎</li>
<li><a class="" href="ronrstudio.html"><span class="header-section-number">14</span> R Studio で R</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">15</span> R Markdown</a></li>
<li><a class="" href="rbasics.html"><span class="header-section-number">16</span> base R</a></li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">17</span> Tidyverse</a></li>
<li><a class="active" href="transform.html"><span class="header-section-number">18</span> 変形（Transform）</a></li>
<li><a class="" href="visualize.html"><span class="header-section-number">19</span> 視覚化（Visualize）</a></li>
<li><a class="" href="import.html"><span class="header-section-number">20</span> Import</a></li>
<li><a class="" href="modeling.html"><span class="header-section-number">21</span> Modeling</a></li>
<li><a class="" href="communicate.html"><span class="header-section-number">22</span> Communicate</a></li>
<li><a class="" href="aboutfirstexample.html"><span class="header-section-number">23</span> 復習</a></li>
<li class="book-part">PART III INSTITUTIONAL DATA</li>
<li><a class="" href="publicdata.html"><span class="header-section-number">24</span> Public Data の分析</a></li>
<li><a class="" href="worldbank.html"><span class="header-section-number">25</span> World Bank</a></li>
<li><a class="" href="un.html"><span class="header-section-number">26</span> UN Data（国際連合データ）</a></li>
<li><a class="" href="owid.html"><span class="header-section-number">27</span> Our World in Data</a></li>
<li><a class="" href="estat.html"><span class="header-section-number">28</span> e-Stat</a></li>
<li><a class="" href="others.html"><span class="header-section-number">29</span> その他のデータベース</a></li>
<li class="book-part">PART IV EDA</li>
<li><a class="" href="intro2eda.html"><span class="header-section-number">30</span> 探索的データ解析</a></li>
<li><a class="" href="worldmap.html"><span class="header-section-number">31</span> 地図 Choropleth Maps</a></li>
<li class="book-part">PART V EXAMPLES</li>
<li><a class="" href="example1.html"><span class="header-section-number">32</span> Example 1</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="japanese.html"><span class="header-section-number">A</span> 日本語の扱いについて</a></li>
<li><a class="" href="tools.html"><span class="header-section-number">B</span> IT ツール</a></li>
<li><a class="" href="bookdown-original.html"><span class="header-section-number">C</span> Bookdown</a></li>
<li><a class="" href="todo-list.html"><span class="header-section-number">D</span> To Do リスト</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/icu-hsuzuki/ds4aj">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="transform" class="section level1" number="18">
<h1>
<span class="header-section-number">18</span> 変形（Transform）<a class="anchor" aria-label="anchor" href="#transform"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p>ここでは、<code>tidyverse</code> パッケージを構成する <code>dplyr</code> パッケージを用いて、データを変形することを学びます。変形とは、例えば、データのなかのある条件を満たす行や列を抽出（取り出）したり、特定の列を修正したり、データの中のいくつかの列に含まれる情報をもとに計算して、新たな列を作ったり、グループに分けたり、順番を入れ替えたりといったことです。データを集約し（まとめ）たり、グラフを作成するときにも、必要不可欠な作業です。</p>
<p><code>dplyr</code> パッケージを用いて、二つのデータを結合することなども可能ですが、それは、あとから扱います。これも、<code>tidyverse</code> パッケージを構成する <code>tidyr</code> パッケージ による変形も、後ほど扱います。</p>
</blockquote>
<p><code>dplyr</code> パッケージは、<code>tidyverse</code> パッケージをインストールしたり、使えるように <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> で読み込んだりするときに、一緒に読み込まれますから、あらためて、<code>dplyr</code> を指定する必要はありません。</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.2     ✔ readr     2.1.4</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.0</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.4.2     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.2     ✔ tidyr     1.3.0</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.1     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<div id="dplyr-概要" class="section level2" number="18.1">
<h2>
<span class="header-section-number">18.1</span> <code>dplyr</code> <a href="https://dplyr.tidyverse.org">概要</a><a class="anchor" aria-label="anchor" href="#dplyr-%E6%A6%82%E8%A6%81"><i class="fas fa-link"></i></a>
</h2>
<p><code>dplyr</code> はデータ操作の文法のようなもので、最も一般的なデータ操作に役立つ一貫したいくつかの「動詞」の役割を果たすものを提供しています。</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> 変数をその名前によって選択 - 列の選択に対応します。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> ケースをその値によって選択 - 行の選択に対応します。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 新しい変数を既存の値を使って定義します - 新しい列を作成することに対応しています。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;summarize()&lt;/code&gt; とつづりをアメリカ式にしても問題ありません。他にも、さまざまな用語は、アメリカ式の綴りでも、イギリス式でも、問題ないようになっています。&lt;/p&gt;"><sup>20</sup></a> たくさんの値を一つの値に集約します - 代表値（平均、メディアンなど）を求めることに対応します。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> 行の順序を変更します。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> グループを指定した表に変換します。</li>
</ul>
<p>さらに詳しく知りたい場合は Console（コンソールに）vignette(“dplyr”) と入れるか、<a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">こちら</a> を参照してください。上では、一つの表について述べていますが、二つの表の扱い方は、Console（コンソール）に vignette(“two-table”) と入れるか、<a href="https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html">こちら</a> を参照してください。二つの表の扱いについては、後から説明します。</p>
<p><code>dplyr</code> を初めて使われる場合には、まず <a href="https://r4ds.hadley.nz/transform">R for data science (2e) Transform</a> を学ばれることをお勧めします。以下も、このサイトに沿った説明をします。</p>
<p>b</p>
<div id="select-名前とタイプによって列変数を選択" class="section level3" number="18.1.1">
<h3>
<span class="header-section-number">18.1.1</span> <a href="https://dplyr.tidyverse.org/reference/select.html"><code>select</code></a>: 名前とタイプによって、列（変数）を選択<a class="anchor" aria-label="anchor" href="#select-%E5%90%8D%E5%89%8D%E3%81%A8%E3%82%BF%E3%82%A4%E3%83%97%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E5%88%97%E5%A4%89%E6%95%B0%E3%82%92%E9%81%B8%E6%8A%9E"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="23%">
<col width="23%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th>補助関数</th>
<th>条件</th>
<th>例</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>-</td>
<td>列の排除</td>
<td>select(iris, -Species)</td>
</tr>
<tr class="even">
<td>:</td>
<td>列の範囲</td>
<td>select(iris, 1:4)</td>
</tr>
<tr class="odd">
<td>contains()</td>
<td>指定文字列を含</td>
<td>select(iris, contains(“Width”))</td>
</tr>
<tr class="even">
<td>ends_with()</td>
<td>指定文字列で終わる</td>
<td>select(iris, ends_with(“th”))</td>
</tr>
<tr class="odd">
<td>matches()</td>
<td>正規表現に適合</td>
<td>select(iris, matches(“S”))</td>
</tr>
<tr class="even">
<td>num_range()</td>
<td>末尾の指定数値範囲</td>
<td>Not applicable with iris</td>
</tr>
<tr class="odd">
<td>one_of()</td>
<td>指定した名前に含まれる</td>
<td>select(iris, one_of(c(“Sepal.Width”, “Petal.Width”)))</td>
</tr>
<tr class="even">
<td>starts_with()</td>
<td>指定文字列で始まる</td>
<td>select(iris, starts_with(“Petal”))</td>
</tr>
</tbody>
</table></div>
<p>「正規表現」という言葉が登場します。検索などでは基本的なものですので、ネット上で調べてください。適切に動作するかを、チェックする、正規表現チェッカーもあります。参照：<a href="https://ja.wikipedia.org/wiki/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE">Wikipedia</a></p>
</div>
<div id="filter-列の値の条件に適合した行の選択" class="section level3" number="18.1.2">
<h3>
<span class="header-section-number">18.1.2</span> <a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter</code></a>: 列の値の条件に適合した行の選択<a class="anchor" aria-label="anchor" href="#filter-%E5%88%97%E3%81%AE%E5%80%A4%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%AB%E9%81%A9%E5%90%88%E3%81%97%E3%81%9F%E8%A1%8C%E3%81%AE%E9%81%B8%E6%8A%9E"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>論理作用素</th>
<th>条件</th>
<th>例</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>&gt;</td>
<td>y より大きい x</td>
<td>x &gt; y</td>
</tr>
<tr class="even">
<td>&gt;=</td>
<td>y 以上の x</td>
<td>x &gt;= y</td>
</tr>
<tr class="odd">
<td>&lt;</td>
<td>y より小さい x</td>
<td>x &lt; y</td>
</tr>
<tr class="even">
<td>&lt;=</td>
<td>y 以下の x</td>
<td>x &lt;= y</td>
</tr>
<tr class="odd">
<td>==</td>
<td>y と等しい x</td>
<td>x == y</td>
</tr>
<tr class="even">
<td>!=</td>
<td>y と等しくない x</td>
<td>x != y</td>
</tr>
<tr class="odd">
<td>is.na()</td>
<td>値が NA である x</td>
<td>is.na(x)</td>
</tr>
<tr class="even">
<td>!is.na()</td>
<td>値が NA でない x</td>
<td>!is.na(x)</td>
</tr>
</tbody>
</table></div>
<p>NA は、not available 値が存在しないという意味です。欠損値のことで、<code>df_wdi</code> などには、一番上に、NA が出てきます。欠損値の扱いも、データサイエンスにおいてはとても大切です。</p>
</div>
<div id="arrange" class="section level3" number="18.1.3">
<h3>
<span class="header-section-number">18.1.3</span> <a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange</code></a><a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> では、選択した列の値によって、行を並び替えます。</p>
<p>注意点すべきは、他の、<code>dplyr</code> の動詞とは異なり、基本的に、グループ化は、無視し、その表全体に適用します。グループ内で並び替えをしたい場合には、グループ化した変数を指定するか、<code>.by_group = TRUE</code> とします。</p>
</div>
<div id="mutate" class="section level3" number="18.1.4">
<h3>
<span class="header-section-number">18.1.4</span> <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate</code></a><a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<p>新しい列を作成または、既存の列を修正、削除します。</p>
<p>以下は便利な補助関数の例です。Help を参照してください。利用するときに、少しずつ説明していきます。ある程度慣れてきたら、どのようなことができるかを把握しておくことは、助けになります。</p>
<ul>
<li><p>+, -, log(), など：通常の数学記号を表します。</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag()</a></code>：<code>lead</code> は次の値、<code>lag</code> は一つ前の値です。</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/row_number.html">dense_rank()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">percent_rank()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">cume_dist()</a></code>, ntile(): <code>rank</code> は、階級、順序を決めます。<code><a href="https://rdrr.io/r/base/rank.html">base::rank</a></code> もあります。基本的に、同じ値があったときに、どのように順序を決めるかがそれぞれによって異なります。</p></li>
<li><p><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean()</a></code>, <code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code>, <code>cummax(),</code> <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumany()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumall()</a></code>: cum は、cumulative（累計）ですから、<code>cumsum</code> は累計、<code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean()</a></code> は、その値までの平均（小計）、<code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code> は、その値までの最小、<code><a href="https://rdrr.io/r/base/cumsum.html">cummax()</a></code> その値までの最大、 <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumany()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cumall()</a></code> は、Help を参照してください。</p></li>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/na_if.html">na_if()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code>: <code>na_if(x,y)</code> は、x の中で、y と等しいものは、NA に置き換え、<code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code> は、最初の欠損していない値を返します。</p></li>
</ul>
</div>
<div id="group_by" class="section level3" number="18.1.5">
<h3>
<span class="header-section-number">18.1.5</span> <a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by</code></a><a class="anchor" aria-label="anchor" href="#group_by"><i class="fas fa-link"></i></a>
</h3>
<p>指定した列の値によって表全体をグループ化した表を作成します。表自体が変形されるわけではありませんから、注意してください。次の、<code>summarize</code> と合わせて利用すると便利です。</p>
</div>
<div id="summarise-or-summarize" class="section level3" number="18.1.6">
<h3>
<span class="header-section-number">18.1.6</span> <a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarise</code> or <code>summarize</code></a><a class="anchor" aria-label="anchor" href="#summarise-or-summarize"><i class="fas fa-link"></i></a>
</h3>
<p>値の集約 (summarize) または、集計に利用します。グループ化された表の場合には、そのグループごとに、値を集約します。</p>
<div id="集約のための関数" class="section level4" number="18.1.6.1">
<h4>
<span class="header-section-number">18.1.6.1</span> 集約のための関数<a class="anchor" aria-label="anchor" href="#%E9%9B%86%E7%B4%84%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E9%96%A2%E6%95%B0"><i class="fas fa-link"></i></a>
</h4>
<p><code>summarize</code> には、 <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, や <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> が使われますが、ベクトルに対して定義され、一つの値だけを出力する関数でであれば、なんでも使うことができます。以下は、その例です。それぞれの関数については、Help で調べてください。</p>
<ol style="list-style-type: decimal">
<li><p>特定の値 - <code>mean(x)</code>, <code>median(x)</code>, <code>quantile(x, 0.25)</code>, <code>min(x)</code>, <code>max(x)</code></p></li>
<li><p>分布の値 - <code>sd(x)</code>, <code>var(x)</code>, <code>IQR(x)</code>, <code>mad(x)</code></p></li>
<li><p>値の位置 - <code>first(x)</code>, <code>nth(x, 2)</code>, <code>last(x)</code></p></li>
<li><p>個数 - <code>n_distinct(x),</code> <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> （引数なし：表またはグループのサイズ）</p></li>
<li><p>論理値の数または割合 - <code>sum(!is.na(x)), mean(y == 0)</code></p></li>
</ol>
<p>条件文で値を指定することも可能です。</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/recode.html">recode()</a></code>, case_when()</li>
</ul>
<p>注: <em>quantile（分位数） と quartile（四分位数）：分位数はデータセットを任意の個数の等しい部分に分割するための値を示し、四分位数はデータセットを4つの等しい部分に分割するための特定の値。</em></p>
</div>
</div>
<div id="パイプpipe" class="section level3" number="18.1.7">
<h3>
<span class="header-section-number">18.1.7</span> パイプ（Pipe）<code>%&gt;%</code> <code>|&gt;</code><a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%A4%E3%83%97pipe"><i class="fas fa-link"></i></a>
</h3>
<p><code>pipe</code> in R は、すでに説明してましたが、ここにまとめておきます。</p>
<p><code>%&gt;%</code> は、<code>tidyverse</code> パッケージで、関数のチェーン化を行うために使用されるパイプ演算子ですが、R 4.1 以降は、<code>|&gt;</code> が、R に組み込まれた、ネイティブなパイプライン演算子になっています。<code>tidyverse</code> を使っているときは、どちらを使うことも可能ですが、<code>|&gt;</code> を使うことをお勧めします。R の versoin を確認するには、コンソール（Console）で、<code><a href="https://rdrr.io/r/base/Version.html">R.Version()</a></code> または、<code>R.version$version.string</code> とします。</p>
<div id="備考-2" class="section level4" number="18.1.7.1">
<h4>
<span class="header-section-number">18.1.7.1</span> <strong>備考</strong><a class="anchor" aria-label="anchor" href="#%E5%82%99%E8%80%83-2"><i class="fas fa-link"></i></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>パイプを使うコードで、複数行にまたがるときは、<code>|&gt;</code> の後で、改行してください。次の行に続くことがわかります。</p></li>
<li><p>実際には、<code>tidyverse</code> の <code>%&gt;%</code> と、R に組み込まれた <code>|&gt;</code> とは多少異なるようです。こちらの<a href="https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/">記事</a>をご覧ください。本書では、<code>|&gt;</code> を使いますが、注意が必要な場合は、コメントします。</p></li>
</ol>
</div>
</div>
</div>
<div id="例から学ぶ-dplyr-i" class="section level2" number="18.2">
<h2>
<span class="header-section-number">18.2</span> 例から学ぶ <code>dplyr,</code> I<a class="anchor" aria-label="anchor" href="#%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6-dplyr-i"><i class="fas fa-link"></i></a>
</h2>
<div id="data-iris" class="section level3" number="18.2.1">
<h3>
<span class="header-section-number">18.2.1</span> Data <code>iris</code><a class="anchor" aria-label="anchor" href="#data-iris"><i class="fas fa-link"></i></a>
</h3>
<p>R 起動時に読み込まれる、<code>datasets</code> の中の、<code>iris</code> （あやめのデータ）を使い、いくつかの例を示します。<code>iris</code> は、何もしなくてもそのまま使えますが、もし、下の結果と違う場合には、すでに、<code>iris</code> を使い、変形などをしている可能性がありますから、そのときは、下のコードを実行してください。</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/iris.html">iris</a></span></span></code></pre></div>
<p>確認します。</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    150 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...</span></span>
<span><span class="co">#&gt;  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...</span></span>
<span><span class="co">#&gt;  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...</span></span>
<span><span class="co">#&gt;  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...</span></span>
<span><span class="co">#&gt;  $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<p><code>df_iris</code> データは、名前のついた5個の変数（列）Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species があり、それぞれ、150の値（observations (obs.) 観察値）からなっています。5番目の Species は、三つのレベルのファクター（factor）setosa, versicolor ともう一つ virginica からなっていることがわかります。<code>unique</code> は、ベクトル型の変数（今の場合は、<code>iris</code> の <code>Species</code> という列）の中の異なる値を抽出します。ファクター（factor）は、ある分け方がされているという意味です。いずれ説明します。</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] setosa     versicolor virginica </span></span>
<span><span class="co">#&gt; Levels: setosa versicolor virginica</span></span></code></pre></div>
</div>
<div id="select-列の抽出" class="section level3" number="18.2.2">
<h3>
<span class="header-section-number">18.2.2</span> <code>select</code> 列の抽出<a class="anchor" aria-label="anchor" href="#select-%E5%88%97%E3%81%AE%E6%8A%BD%E5%87%BA"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="select-1---第-1-2-5-列を抽出" class="section level3" number="18.2.3">
<h3>
<span class="header-section-number">18.2.3</span> <code>select</code> 1 - 第 1, 2, 5 列を抽出<a class="anchor" aria-label="anchor" href="#select-1---%E7%AC%AC-1-2-5-%E5%88%97%E3%82%92%E6%8A%BD%E5%87%BA"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.6         3.1  setosa</span></span>
<span><span class="co">#&gt; 5          5.0         3.6  setosa</span></span>
<span><span class="co">#&gt; 6          5.4         3.9  setosa</span></span></code></pre></div>
<p>第1列、第2列、第5列を、<code>c(1,2,5)</code> で表しています。列名で指定することもできます。</p>
<p><code>head(select(df_iris, c(1,2,5)))</code> としてありますから、その最初の6行を表示していますが、新しい変数を割り当ててはいませんから、<code>df_iris</code> 自体は変更されていません。</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_iris</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></span></code></pre></div>
<p>第1列、第2列、第5列を選んだものを、あとから使いたいときは、新しい名前をつける必要があります。以下同様ですが、この場合だけ、<code>df_iris125</code> という名前（object name）をつけておきましょう。</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris125</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_iris125</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.6         3.1  setosa</span></span>
<span><span class="co">#&gt; 5          5.0         3.6  setosa</span></span>
<span><span class="co">#&gt; 6          5.4         3.9  setosa</span></span></code></pre></div>
<div id="パイプpipe-を使ったコード" class="section level4" number="18.2.3.1">
<h4>
<span class="header-section-number">18.2.3.1</span> パイプ（Pipe） <code>|&gt;</code> を使ったコード<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%A4%E3%83%97pipe-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89"><i class="fas fa-link"></i></a>
</h4>
<p>最初の例では <code>head(select(df_iris, c(1,2,5)))</code> としました。<code>head</code> の引数として、 <code>select(df_iris, c(1,2,5))</code> を使ったからです。しかし、慣れてくると、順番に関数を適用することを表現するには、 パイプを使うのも便利です。パイプでは、直前の出力が次の関数の第一引数として引き継がれるというルールになっています。以下のようになります。</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Species</span></span>
<span><span class="co">#&gt; 1          5.1         3.5  setosa</span></span>
<span><span class="co">#&gt; 2          4.9         3.0  setosa</span></span>
<span><span class="co">#&gt; 3          4.7         3.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.6         3.1  setosa</span></span>
<span><span class="co">#&gt; 5          5.0         3.6  setosa</span></span>
<span><span class="co">#&gt; 6          5.4         3.9  setosa</span></span></code></pre></div>
<p>もちろん、<code>select(c(1,2,5)</code>) でも同じ結果が得られます。より、詳しく知りたい場合には、Help に <code>|&gt;</code> と入れて説明を読んでください。</p>
<p>In the following, we use pipes.</p>
</div>
</div>
<div id="select-2---species-列以外" class="section level3" number="18.2.4">
<h3>
<span class="header-section-number">18.2.4</span> <code>select</code> 2 - Species 列以外<a class="anchor" aria-label="anchor" href="#select-2---species-%E5%88%97%E4%BB%A5%E5%A4%96"><i class="fas fa-link"></i></a>
</h3>
<p>列名の前に、<code>-</code> ハイフン（半角）をつけると、その列以外を抽出します。</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">#&gt; 1          5.1         3.5          1.4         0.2</span></span>
<span><span class="co">#&gt; 2          4.9         3.0          1.4         0.2</span></span>
<span><span class="co">#&gt; 3          4.7         3.2          1.3         0.2</span></span>
<span><span class="co">#&gt; 4          4.6         3.1          1.5         0.2</span></span>
<span><span class="co">#&gt; 5          5.0         3.6          1.4         0.2</span></span>
<span><span class="co">#&gt; 6          5.4         3.9          1.7         0.4</span></span></code></pre></div>
</div>
<div id="select-3---列を抽出するとともに列名も変更" class="section level3" number="18.2.5">
<h3>
<span class="header-section-number">18.2.5</span> <code>select</code> 3 - 列を抽出するとともに列名も変更<a class="anchor" aria-label="anchor" href="#select-3---%E5%88%97%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E5%88%97%E5%90%8D%E3%82%82%E5%A4%89%E6%9B%B4"><i class="fas fa-link"></i></a>
</h3>
<p>新しい列名 = 現在の列名 という形式で、列名を変更することも可能です。</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df_iris</span>, sl <span class="op">=</span> <span class="va">Sepal.Length</span>, sw <span class="op">=</span> <span class="va">Sepal.Width</span>, sp <span class="op">=</span> <span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    sl  sw     sp</span></span>
<span><span class="co">#&gt; 1 5.1 3.5 setosa</span></span>
<span><span class="co">#&gt; 2 4.9 3.0 setosa</span></span>
<span><span class="co">#&gt; 3 4.7 3.2 setosa</span></span>
<span><span class="co">#&gt; 4 4.6 3.1 setosa</span></span>
<span><span class="co">#&gt; 5 5.0 3.6 setosa</span></span>
<span><span class="co">#&gt; 6 5.4 3.9 setosa</span></span></code></pre></div>
</div>
<div id="select-4---列順の変更" class="section level3" number="18.2.6">
<h3>
<span class="header-section-number">18.2.6</span> <code>select</code> 4 - 列順の変更<a class="anchor" aria-label="anchor" href="#select-4---%E5%88%97%E9%A0%86%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Species Petal.Length Petal.Width Sepal.Length Sepal.Width</span></span>
<span><span class="co">#&gt; 1  setosa          1.4         0.2          5.1         3.5</span></span>
<span><span class="co">#&gt; 2  setosa          1.4         0.2          4.9         3.0</span></span>
<span><span class="co">#&gt; 3  setosa          1.3         0.2          4.7         3.2</span></span>
<span><span class="co">#&gt; 4  setosa          1.5         0.2          4.6         3.1</span></span>
<span><span class="co">#&gt; 5  setosa          1.4         0.2          5.0         3.6</span></span>
<span><span class="co">#&gt; 6  setosa          1.7         0.4          5.4         3.9</span></span></code></pre></div>
<div id="備考-3" class="section level4" number="18.2.6.1">
<h4>
<span class="header-section-number">18.2.6.1</span> 備考<a class="anchor" aria-label="anchor" href="#%E5%82%99%E8%80%83-3"><i class="fas fa-link"></i></a>
</h4>
<ol style="list-style-type: decimal">
<li>上の、<code>select</code> の 補助関数（helper functions）にも書きましたように、他にも様々な方法で、列を抽出することが可能です。たくさんの列がある表に出会ったら、ぜひ活用してください。</li>
<li>最初は、それほど大きなデータ（表）を扱うことは少ないかもしれませんが、それでも、上で紹介した、列の名前を変更したり、列の順序を変更するなどは、有益です。使いやすく、見やすい形に変えてから、作業をすることはおすすめです。</li>
</ol>
</div>
</div>
<div id="filter---値による抽出" class="section level3" number="18.2.7">
<h3>
<span class="header-section-number">18.2.7</span> <code>filter</code> - 値による抽出<a class="anchor" aria-label="anchor" href="#filter---%E5%80%A4%E3%81%AB%E3%82%88%E3%82%8B%E6%8A%BD%E5%87%BA"><i class="fas fa-link"></i></a>
</h3>
<p>Species の列の値が、virginica であるものだけを抽出します。<code>==</code> とイコールが二つであることと、文字列の場合には、半角の引用符（double quote）でくくります。‘verginica’ でも同じです。（列名に空白や、特殊記号が含まれているときには、back tick と呼ばれる、反対向きの引用符で括ります。あとからその必要が生じたときに説明します。）</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width</span></span>
<span><span class="co">#&gt; 1          6.3         3.3          6.0         2.5</span></span>
<span><span class="co">#&gt; 2          5.8         2.7          5.1         1.9</span></span>
<span><span class="co">#&gt; 3          7.1         3.0          5.9         2.1</span></span>
<span><span class="co">#&gt; 4          6.3         2.9          5.6         1.8</span></span>
<span><span class="co">#&gt; 5          6.5         3.0          5.8         2.2</span></span>
<span><span class="co">#&gt; 6          7.6         3.0          6.6         2.1</span></span>
<span><span class="co">#&gt;     Species</span></span>
<span><span class="co">#&gt; 1 virginica</span></span>
<span><span class="co">#&gt; 2 virginica</span></span>
<span><span class="co">#&gt; 3 virginica</span></span>
<span><span class="co">#&gt; 4 virginica</span></span>
<span><span class="co">#&gt; 5 virginica</span></span>
<span><span class="co">#&gt; 6 virginica</span></span></code></pre></div>
<div id="備考-4" class="section level4" number="18.2.7.1">
<h4>
<span class="header-section-number">18.2.7.1</span> 備考　<a class="anchor" aria-label="anchor" href="#%E5%82%99%E8%80%83-4"><i class="fas fa-link"></i></a>
</h4>
<ul>
<li><p><code>filter</code> は特に重要ですが、もう少し複雑なデータ（表）を例にとって、後ほど説明します。</p></li>
<li><p>上にも少し書いた、正規表現を使えるようになると、かなり複雑な条件での、抽出も可能になります。</p></li>
</ul>
</div>
</div>
<div id="arrange---昇順降順" class="section level3" number="18.2.8">
<h3>
<span class="header-section-number">18.2.8</span> <code>arrange</code> - 昇順、降順<a class="anchor" aria-label="anchor" href="#arrange---%E6%98%87%E9%A0%86%E9%99%8D%E9%A0%86"><i class="fas fa-link"></i></a>
</h3>
<p>次の例では、Sepal.Length の値の、昇順（小さい順）にし、同じ値の中では、Spepal.Width の降順（大きい順 （desc は descending order からとったもの）にします。Sepal.Length の値が、4.4 の部分の、Sepal.Width の値をみてください。</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">df_iris</span>, <span class="va">Sepal.Length</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          4.3         3.0          1.1         0.1  setosa</span></span>
<span><span class="co">#&gt; 2          4.4         3.2          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.4         3.0          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.4         2.9          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 5          4.5         2.3          1.3         0.3  setosa</span></span>
<span><span class="co">#&gt; 6          4.6         3.6          1.0         0.2  setosa</span></span></code></pre></div>
</div>
<div id="mutate---rank階級" class="section level3" number="18.2.9">
<h3>
<span class="header-section-number">18.2.9</span> <code>mutate</code> - rank（階級）<a class="anchor" aria-label="anchor" href="#mutate---rank%E9%9A%8E%E7%B4%9A"><i class="fas fa-link"></i></a>
</h3>
<p>小さい順に順序付けて新しい列を作成し、その順序で表示します。順序付も様々な種類があります。ここでは、同じ値のときには、同じ階級にしています。下の出力を右の方を見てください。1, 2, 2, 2, 5, … となっています。</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sl_rank <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sl_rank</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span><span class="co">#&gt; 1          4.3         3.0          1.1         0.1  setosa</span></span>
<span><span class="co">#&gt; 2          4.4         2.9          1.4         0.2  setosa</span></span>
<span><span class="co">#&gt; 3          4.4         3.0          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 4          4.4         3.2          1.3         0.2  setosa</span></span>
<span><span class="co">#&gt; 5          4.5         2.3          1.3         0.3  setosa</span></span>
<span><span class="co">#&gt; 6          4.6         3.1          1.5         0.2  setosa</span></span>
<span><span class="co">#&gt;   sl_rank</span></span>
<span><span class="co">#&gt; 1       1</span></span>
<span><span class="co">#&gt; 2       2</span></span>
<span><span class="co">#&gt; 3       2</span></span>
<span><span class="co">#&gt; 4       2</span></span>
<span><span class="co">#&gt; 5       5</span></span>
<span><span class="co">#&gt; 6       6</span></span></code></pre></div>
<div id="備考-5" class="section level4" number="18.2.9.1">
<h4>
<span class="header-section-number">18.2.9.1</span> 備考<a class="anchor" aria-label="anchor" href="#%E5%82%99%E8%80%83-5"><i class="fas fa-link"></i></a>
</h4>
<ol style="list-style-type: decimal">
<li>パイプを紹介したときにも書きましたが、改行は、<code>|&gt;</code> のあとでしてください。</li>
<li>
<code>mutate</code> は、新しい列を加えるだけでなく、既存の列を修正するためにも使うことができます。修正した、データを使うときは、同じ名前のオブジェクトに <code>-&gt;</code> で、アサインすることも、可能ですが、新しい名前をつけて、新しいオブジェクトとして活用することをお勧めします。</li>
</ol>
</div>
</div>
<div id="group_by-and-summarize" class="section level3" number="18.2.10">
<h3>
<span class="header-section-number">18.2.10</span> <code>group_by</code> and <code>summarize</code><a class="anchor" aria-label="anchor" href="#group_by-and-summarize"><i class="fas fa-link"></i></a>
</h3>
<p>グループにわけて、グループごとに、平均を求めています。</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>sl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>, sw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sepal.Width</span><span class="op">)</span>, </span>
<span>  pl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Petal.Length</span><span class="op">)</span>, pw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Petal.Width</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   Species       sl    sw    pl    pw</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 setosa      5.01  3.43  1.46 0.246</span></span>
<span><span class="co">#&gt; 2 versicolor  5.94  2.77  4.26 1.33 </span></span>
<span><span class="co">#&gt; 3 virginica   6.59  2.97  5.55 2.03</span></span></code></pre></div>
<ul>
<li>mean: <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> or <code>mean(x, na.rm = TRUE)</code> - 相加平均 (average)</li>
<li>median: <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code> , <code>median(x, na.rm = TRUE)</code> - 中央値（mid value）</li>
</ul>
<p>以下のリンクには、もう少し例が書かれています。</p>
<p><a href="https://icu-hsuzuki.github.io/da4r2022_note/dplyr-iris.nb.html">dplr_iris</a></p>
</div>
</div>
<div id="dplyr-の参考文献" class="section level2" number="18.3">
<h2>
<span class="header-section-number">18.3</span> <code>dplyr</code> の参考文献<a class="anchor" aria-label="anchor" href="#dplyr-%E3%81%AE%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fas fa-link"></i></a>
</h2>
<p>より詳しい説明は、教科書の該当箇所を見てください。</p>
<ul>
<li><a href="https://r4ds.had.co.nz/wrangle-intro.html#wrangle-intro">R for Data Science, Part II Explore</a></li>
<li><a href="https://r4ds.hadley.nz/transform">R for Data Science (2e), Transform</a></li>
</ul>
<div id="rstudio-primers-対話型の演習問題" class="section level3" number="18.3.1">
<h3>
<span class="header-section-number">18.3.1</span> RStudio Primers: 対話型の演習問題<a class="anchor" aria-label="anchor" href="#rstudio-primers-%E5%AF%BE%E8%A9%B1%E5%9E%8B%E3%81%AE%E6%BC%94%E7%BF%92%E5%95%8F%E9%A1%8C"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>Work with Data – <a href="https://r4ds.had.co.nz/wrangle-intro.html#wrangle-intro">r4ds: Wrangle, I</a>
</li>
</ol>
<ul>
<li><a href="https://rstudio.cloud/learn/primers/2.1">Working with Tibbles</a></li>
<li><a href="https://rstudio.cloud/learn/primers/2.2">Isolating Data with dplyr</a></li>
<li><a href="https://rstudio.cloud/learn/primers/2.3">Deriving Information with dplyr</a></li>
</ul>
</div>
</div>
<div id="例から学ぶ-dplyr-ii" class="section level2" number="18.4">
<h2>
<span class="header-section-number">18.4</span> 例から学ぶ <code>dplyr,</code> II<a class="anchor" aria-label="anchor" href="#%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6-dplyr-ii"><i class="fas fa-link"></i></a>
</h2>
<div id="df_wdi-df_wdi_extra" class="section level3" number="18.4.1">
<h3>
<span class="header-section-number">18.4.1</span> df_wdi, df_wdi_extra<a class="anchor" aria-label="anchor" href="#df_wdi-df_wdi_extra"><i class="fas fa-link"></i></a>
</h3>
<p>前の章の <code>Tidyverse</code> で読み込み、概観した、世界開発指標（World Development Indicators）のデータを使います。<a href="https://icu-hsuzuki.github.io/ds4aj/tidyverse.html#wdi-%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF">参照：WDI のデータ</a></p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/WDI/">WDI</a></span><span class="op">)</span></span></code></pre></div>
<p>WDI の使い方は、世界銀行の部分で紹介しますが、はじめてのデータサイエンスの例でも紹介したように、データコードを利用して、データを読み込みます。ここでは、出生時の平均寿命と、一人当たりの　GDP と、総人口のデータを使います。</p>
<ul>
<li>SP.DYN.LE00.IN: Life expectancy at birth, total (years) 出生時の平均寿命</li>
<li>SP.POP.TOTL: Population, total 総人口</li>
<li>NY.GDP.PCAP.KD: GDP per capita (constant 2015 US$) 一人当たりの　GDP</li>
</ul>
<p>次のコードで読み込みます。</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vincentarelbundock.github.io/WDI/reference/WDI.html">WDI</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"all"</span>, </span>
<span>  indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="st">"SP.DYN.LE00.IN"</span>, pop <span class="op">=</span> <span class="st">"SP.POP.TOTL"</span>, gdpPercap <span class="op">=</span> <span class="st">"NY.GDP.PCAP.KD"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; Rows: 16758 Columns: 7
#&gt; ── Column specification ────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr (3): country, iso2c, iso3c
#&gt; dbl (4): year, lifeExp, pop, gdpPercap
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi_extra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vincentarelbundock.github.io/WDI/reference/WDI.html">WDI</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="st">"all"</span>, </span>
<span>  indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>lifeExp <span class="op">=</span> <span class="st">"SP.DYN.LE00.IN"</span>, pop <span class="op">=</span> <span class="st">"SP.POP.TOTL"</span>, gdpPercap <span class="op">=</span> <span class="st">"NY.GDP.PCAP.KD"</span><span class="op">)</span>, </span>
<span>  extra <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>すこし、追加情報を付加したものも取得しておきます。</p>
<pre><code>#&gt; Rows: 16758 Columns: 15
#&gt; ── Column specification ────────────────────────────────────
#&gt; Delimiter: ","
#&gt; chr  (7): country, iso2c, iso3c, region, capital, income...
#&gt; dbl  (6): year, lifeExp, pop, gdpPercap, longitude, lati...
#&gt; lgl  (1): status
#&gt; date (1): lastupdated
#&gt; 
#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.
#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi_extra</span></span>
<span><span class="co">#&gt; # A tibble: 16,758 × 15</span></span>
<span><span class="co">#&gt;    country     iso2c iso3c  year status lastupdated lifeExp</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt;  &lt;date&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Afghanistan AF    AFG    2014 NA     2023-07-25     62.5</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF    AFG    2012 NA     2023-07-25     61.9</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF    AFG    2009 NA     2023-07-25     60.4</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF    AFG    2013 NA     2023-07-25     62.4</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF    AFG    1971 NA     2023-07-25     37.9</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF    AFG    2015 NA     2023-07-25     62.7</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF    AFG    1969 NA     2023-07-25     36.9</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF    AFG    2010 NA     2023-07-25     60.9</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF    AFG    2011 NA     2023-07-25     61.4</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF    AFG    2008 NA     2023-07-25     59.9</span></span>
<span><span class="co">#&gt; # ℹ 16,748 more rows</span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: pop &lt;dbl&gt;, gdpPercap &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   region &lt;chr&gt;, capital &lt;chr&gt;, longitude &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   latitude &lt;dbl&gt;, income &lt;chr&gt;, lending &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="ggplot2" class="section level3" number="18.4.2">
<h3>
<span class="header-section-number">18.4.2</span> <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>また、前の章の <code>Tidyverse</code> の説明で、あやめ（iris）のデータを使って、視覚化の説明を、散布図を使って、少ししました。参照：<a href="https://icu-hsuzuki.github.io/ds4aj/tidyverse.html#ggplot2-%E3%82%B0%E3%83%A9%E3%83%95%E3%81%AE%E6%8F%8F%E7%94%BB">ggplot2 グラフの描画</a></p>
<p>詳細は、次の、視覚化のところで説明しますが、視覚化のためには、データの変形、整理が必要であることを、理解していただくために、散布図と、箱ひげ図の基本的な場合のみ、以下のような形式で利用します。</p>
<p><strong>例1 散布図（scatter plot）</strong></p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-25-1.png" width="672"></div>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_iris</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-26-1.png" width="672"></div>
</div>
<div id="dplyr-の応用" class="section level3" number="18.4.3">
<h3>
<span class="header-section-number">18.4.3</span> <code>dplyr</code> の応用<a class="anchor" aria-label="anchor" href="#dplyr-%E3%81%AE%E5%BF%9C%E7%94%A8"><i class="fas fa-link"></i></a>
</h3>
<p>すべて、<code>dplyr</code> というわけではありませんが、データを理解していきたいと思います。</p>
<p>二つのデータ <code>df_wdi</code> と <code>df_wdi_extra</code> がありました。この違いをまずは見ていきましょう。<code>colnames</code> は、列名が並んだもの（ベクトル）を出力します。</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "country"   "iso2c"     "iso3c"     "year"     </span></span>
<span><span class="co">#&gt; [5] "lifeExp"   "pop"       "gdpPercap"</span></span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi_extra</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "country"     "iso2c"       "iso3c"       "year"       </span></span>
<span><span class="co">#&gt;  [5] "status"      "lastupdated" "lifeExp"     "pop"        </span></span>
<span><span class="co">#&gt;  [9] "gdpPercap"   "region"      "capital"     "longitude"  </span></span>
<span><span class="co">#&gt; [13] "latitude"    "income"      "lending"</span></span></code></pre></div>
<p><code>df_wdi_extra</code> の一部が、<code>df_wdi</code> のようです。</p>
<p>ここからは、しばらく、<code>df_wdi_extra</code> をみていきます。<code>range</code> は、最小、最大を見るのに使います。<code>df_wdi_extra$year</code> は、<code>df_wdi_extra</code> の <code>year</code> の列を取り出したもの（ベクトルといいます）です。</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">df_wdi_extra</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1960 2022</span></span></code></pre></div>
<p><code>unique</code> を使って、その列で相異なるものをすべてリストすることもできます。</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_wdi_extra</span><span class="op">$</span><span class="va">income</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Low income"          "Aggregates"         </span></span>
<span><span class="co">#&gt; [3] "Upper middle income" "Lower middle income"</span></span>
<span><span class="co">#&gt; [5] "High income"         NA                   </span></span>
<span><span class="co">#&gt; [7] "Not classified"</span></span></code></pre></div>
<p>Aggregates とか、Not classified とか、NA は何を表しているのでしょうか。あとで見てみましょう。Google Public Data Explorer を使ったときに、Income Level というものがありました。覚えていますか。</p>
<p><strong>参考：<a href="https://datatopics.worldbank.org/world-development-indicators/the-world-by-income-and-region.html">The World by Income and Region</a></strong></p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_wdi_extra</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "South Asia"                </span></span>
<span><span class="co">#&gt; [2] "Aggregates"                </span></span>
<span><span class="co">#&gt; [3] "Europe &amp; Central Asia"     </span></span>
<span><span class="co">#&gt; [4] "Middle East &amp; North Africa"</span></span>
<span><span class="co">#&gt; [5] "East Asia &amp; Pacific"       </span></span>
<span><span class="co">#&gt; [6] "Sub-Saharan Africa"        </span></span>
<span><span class="co">#&gt; [7] "Latin America &amp; Caribbean" </span></span>
<span><span class="co">#&gt; [8] "North America"             </span></span>
<span><span class="co">#&gt; [9] NA</span></span></code></pre></div>
<p>これらは、あとで使いますから、残しておきましょう。そこで、country, iso2c, year, liefExp, pop, gdpPercap, income, region だけを取り出します。列を選択するので、<code>select</code> を使います。</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">&lt;-</span> <span class="va">df_wdi_extra</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">iso2c</span>, <span class="va">year</span>, <span class="va">lifeExp</span>, <span class="va">pop</span>, <span class="va">gdpPercap</span>, <span class="va">income</span>, <span class="va">region</span><span class="op">)</span></span>
<span><span class="va">df_wdi3</span></span>
<span><span class="co">#&gt; # A tibble: 16,758 × 8</span></span>
<span><span class="co">#&gt;    country     iso2c  year lifeExp      pop gdpPercap income</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1 Afghanistan AF     2014    62.5 32716210      603. Low i…</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF     2012    61.9 30466479      596. Low i…</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF     2009    60.4 27385307      512. Low i…</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF     2013    62.4 31541209      608. Low i…</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF     1971    37.9 11015857       NA  Low i…</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF     2015    62.7 33753499      592. Low i…</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF     1969    36.9 10494489       NA  Low i…</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF     2010    60.9 28189672      569. Low i…</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF     2011    61.4 29249157      551. Low i…</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF     2008    59.9 26427199      437. Low i…</span></span>
<span><span class="co">#&gt; # ℹ 16,748 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: region &lt;chr&gt;</span></span></code></pre></div>
<p>何列目かを指定することもできます。今回は少し多いので大変ですが。</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi_extra</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">14</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 16,758 × 8</span></span>
<span><span class="co">#&gt;    country     iso2c  year lifeExp      pop gdpPercap region</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1 Afghanistan AF     2014    62.5 32716210      603. South…</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF     2012    61.9 30466479      596. South…</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF     2009    60.4 27385307      512. South…</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF     2013    62.4 31541209      608. South…</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF     1971    37.9 11015857       NA  South…</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF     2015    62.7 33753499      592. South…</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF     1969    36.9 10494489       NA  South…</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF     2010    60.9 28189672      569. South…</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF     2011    61.4 29249157      551. South…</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF     2008    59.9 26427199      437. South…</span></span>
<span><span class="co">#&gt; # ℹ 16,748 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: income &lt;chr&gt;</span></span></code></pre></div>
<p>Aggregates は何を意味しているのかみてみましょう。filter で、その行だけを取り出します。</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">==</span> <span class="st">"Aggregates"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2,646 × 8</span></span>
<span><span class="co">#&gt;    country       iso2c  year lifeExp    pop gdpPercap income</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1 Africa Easte… ZH     1989    50.7 3.01e8     1367. Aggre…</span></span>
<span><span class="co">#&gt;  2 Africa Easte… ZH     1990    50.6 3.10e8     1329. Aggre…</span></span>
<span><span class="co">#&gt;  3 Africa Easte… ZH     1973    47.7 1.88e8     1450. Aggre…</span></span>
<span><span class="co">#&gt;  4 Africa Easte… ZH     1974    47.6 1.94e8     1491. Aggre…</span></span>
<span><span class="co">#&gt;  5 Africa Easte… ZH     1977    48.6 2.11e8     1448. Aggre…</span></span>
<span><span class="co">#&gt;  6 Africa Easte… ZH     1978    48.8 2.17e8     1421. Aggre…</span></span>
<span><span class="co">#&gt;  7 Africa Easte… ZH     1972    46.9 1.83e8     1429. Aggre…</span></span>
<span><span class="co">#&gt;  8 Africa Easte… ZH     1987    50.1 2.84e8     1352. Aggre…</span></span>
<span><span class="co">#&gt;  9 Africa Easte… ZH     1975    47.8 1.99e8     1473. Aggre…</span></span>
<span><span class="co">#&gt; 10 Africa Easte… ZH     1976    48.3 2.05e8     1472. Aggre…</span></span>
<span><span class="co">#&gt; # ℹ 2,636 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: region &lt;chr&gt;</span></span></code></pre></div>
<p>どうも、国ではなく、地域のようです。確認しておきましょう。unique を使って、</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">df_wdi3</span>, <span class="va">income</span> <span class="op">==</span> <span class="st">"Aggregates"</span><span class="op">)</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Africa Eastern and Southern"                         </span></span>
<span><span class="co">#&gt;  [2] "Africa Western and Central"                          </span></span>
<span><span class="co">#&gt;  [3] "Arab World"                                          </span></span>
<span><span class="co">#&gt;  [4] "Caribbean small states"                              </span></span>
<span><span class="co">#&gt;  [5] "Central Europe and the Baltics"                      </span></span>
<span><span class="co">#&gt;  [6] "Early-demographic dividend"                          </span></span>
<span><span class="co">#&gt;  [7] "East Asia &amp; Pacific"                                 </span></span>
<span><span class="co">#&gt;  [8] "East Asia &amp; Pacific (excluding high income)"         </span></span>
<span><span class="co">#&gt;  [9] "East Asia &amp; Pacific (IDA &amp; IBRD countries)"          </span></span>
<span><span class="co">#&gt; [10] "Euro area"                                           </span></span>
<span><span class="co">#&gt; [11] "Europe &amp; Central Asia"                               </span></span>
<span><span class="co">#&gt; [12] "Europe &amp; Central Asia (excluding high income)"       </span></span>
<span><span class="co">#&gt; [13] "Europe &amp; Central Asia (IDA &amp; IBRD countries)"        </span></span>
<span><span class="co">#&gt; [14] "European Union"                                      </span></span>
<span><span class="co">#&gt; [15] "Fragile and conflict affected situations"            </span></span>
<span><span class="co">#&gt; [16] "Heavily indebted poor countries (HIPC)"              </span></span>
<span><span class="co">#&gt; [17] "IBRD only"                                           </span></span>
<span><span class="co">#&gt; [18] "IDA &amp; IBRD total"                                    </span></span>
<span><span class="co">#&gt; [19] "IDA blend"                                           </span></span>
<span><span class="co">#&gt; [20] "IDA only"                                            </span></span>
<span><span class="co">#&gt; [21] "IDA total"                                           </span></span>
<span><span class="co">#&gt; [22] "Late-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [23] "Latin America &amp; Caribbean (excluding high income)"   </span></span>
<span><span class="co">#&gt; [24] "Latin America &amp; the Caribbean (IDA &amp; IBRD countries)"</span></span>
<span><span class="co">#&gt; [25] "Least developed countries: UN classification"        </span></span>
<span><span class="co">#&gt; [26] "Low &amp; middle income"                                 </span></span>
<span><span class="co">#&gt; [27] "Middle East &amp; North Africa"                          </span></span>
<span><span class="co">#&gt; [28] "Middle East &amp; North Africa (excluding high income)"  </span></span>
<span><span class="co">#&gt; [29] "Middle East &amp; North Africa (IDA &amp; IBRD countries)"   </span></span>
<span><span class="co">#&gt; [30] "Middle income"                                       </span></span>
<span><span class="co">#&gt; [31] "North America"                                       </span></span>
<span><span class="co">#&gt; [32] "OECD members"                                        </span></span>
<span><span class="co">#&gt; [33] "Other small states"                                  </span></span>
<span><span class="co">#&gt; [34] "Pacific island small states"                         </span></span>
<span><span class="co">#&gt; [35] "Post-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [36] "Pre-demographic dividend"                            </span></span>
<span><span class="co">#&gt; [37] "Small states"                                        </span></span>
<span><span class="co">#&gt; [38] "South Asia"                                          </span></span>
<span><span class="co">#&gt; [39] "South Asia (IDA &amp; IBRD)"                             </span></span>
<span><span class="co">#&gt; [40] "Sub-Saharan Africa (excluding high income)"          </span></span>
<span><span class="co">#&gt; [41] "Sub-Saharan Africa (IDA &amp; IBRD countries)"           </span></span>
<span><span class="co">#&gt; [42] "World"</span></span></code></pre></div>
<p>とする手もありますが、パイプを使うときは、そのまま、country で異なるものを取り出した表にした方が簡単なので、<code>distinct</code> を使って、次のようにすることもできます。</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">==</span> <span class="st">"Aggregates"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 42 × 1</span></span>
<span><span class="co">#&gt;    country                                    </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                      </span></span>
<span><span class="co">#&gt;  1 Africa Eastern and Southern                </span></span>
<span><span class="co">#&gt;  2 Africa Western and Central                 </span></span>
<span><span class="co">#&gt;  3 Arab World                                 </span></span>
<span><span class="co">#&gt;  4 Caribbean small states                     </span></span>
<span><span class="co">#&gt;  5 Central Europe and the Baltics             </span></span>
<span><span class="co">#&gt;  6 Early-demographic dividend                 </span></span>
<span><span class="co">#&gt;  7 East Asia &amp; Pacific                        </span></span>
<span><span class="co">#&gt;  8 East Asia &amp; Pacific (excluding high income)</span></span>
<span><span class="co">#&gt;  9 East Asia &amp; Pacific (IDA &amp; IBRD countries) </span></span>
<span><span class="co">#&gt; 10 Euro area                                  </span></span>
<span><span class="co">#&gt; # ℹ 32 more rows</span></span></code></pre></div>
<p>unique を使った場合と同じ表示にしたければ、最後に　<code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code> を付け加えて、その列だけを、並べて（ベクトル）表示することも可能です。</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">==</span> <span class="st">"Aggregates"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Africa Eastern and Southern"                         </span></span>
<span><span class="co">#&gt;  [2] "Africa Western and Central"                          </span></span>
<span><span class="co">#&gt;  [3] "Arab World"                                          </span></span>
<span><span class="co">#&gt;  [4] "Caribbean small states"                              </span></span>
<span><span class="co">#&gt;  [5] "Central Europe and the Baltics"                      </span></span>
<span><span class="co">#&gt;  [6] "Early-demographic dividend"                          </span></span>
<span><span class="co">#&gt;  [7] "East Asia &amp; Pacific"                                 </span></span>
<span><span class="co">#&gt;  [8] "East Asia &amp; Pacific (excluding high income)"         </span></span>
<span><span class="co">#&gt;  [9] "East Asia &amp; Pacific (IDA &amp; IBRD countries)"          </span></span>
<span><span class="co">#&gt; [10] "Euro area"                                           </span></span>
<span><span class="co">#&gt; [11] "Europe &amp; Central Asia"                               </span></span>
<span><span class="co">#&gt; [12] "Europe &amp; Central Asia (excluding high income)"       </span></span>
<span><span class="co">#&gt; [13] "Europe &amp; Central Asia (IDA &amp; IBRD countries)"        </span></span>
<span><span class="co">#&gt; [14] "European Union"                                      </span></span>
<span><span class="co">#&gt; [15] "Fragile and conflict affected situations"            </span></span>
<span><span class="co">#&gt; [16] "Heavily indebted poor countries (HIPC)"              </span></span>
<span><span class="co">#&gt; [17] "IBRD only"                                           </span></span>
<span><span class="co">#&gt; [18] "IDA &amp; IBRD total"                                    </span></span>
<span><span class="co">#&gt; [19] "IDA blend"                                           </span></span>
<span><span class="co">#&gt; [20] "IDA only"                                            </span></span>
<span><span class="co">#&gt; [21] "IDA total"                                           </span></span>
<span><span class="co">#&gt; [22] "Late-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [23] "Latin America &amp; Caribbean (excluding high income)"   </span></span>
<span><span class="co">#&gt; [24] "Latin America &amp; the Caribbean (IDA &amp; IBRD countries)"</span></span>
<span><span class="co">#&gt; [25] "Least developed countries: UN classification"        </span></span>
<span><span class="co">#&gt; [26] "Low &amp; middle income"                                 </span></span>
<span><span class="co">#&gt; [27] "Middle East &amp; North Africa"                          </span></span>
<span><span class="co">#&gt; [28] "Middle East &amp; North Africa (excluding high income)"  </span></span>
<span><span class="co">#&gt; [29] "Middle East &amp; North Africa (IDA &amp; IBRD countries)"   </span></span>
<span><span class="co">#&gt; [30] "Middle income"                                       </span></span>
<span><span class="co">#&gt; [31] "North America"                                       </span></span>
<span><span class="co">#&gt; [32] "OECD members"                                        </span></span>
<span><span class="co">#&gt; [33] "Other small states"                                  </span></span>
<span><span class="co">#&gt; [34] "Pacific island small states"                         </span></span>
<span><span class="co">#&gt; [35] "Post-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [36] "Pre-demographic dividend"                            </span></span>
<span><span class="co">#&gt; [37] "Small states"                                        </span></span>
<span><span class="co">#&gt; [38] "South Asia"                                          </span></span>
<span><span class="co">#&gt; [39] "South Asia (IDA &amp; IBRD)"                             </span></span>
<span><span class="co">#&gt; [40] "Sub-Saharan Africa (excluding high income)"          </span></span>
<span><span class="co">#&gt; [41] "Sub-Saharan Africa (IDA &amp; IBRD countries)"           </span></span>
<span><span class="co">#&gt; [42] "World"</span></span></code></pre></div>
<p>unclassified と、NA もみておきましょう。まず、Aggregates 以外を見たいので、等しくないは、<code>!=</code> を使います。</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">!=</span> <span class="st">"Aggregates"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 5 × 1</span></span>
<span><span class="co">#&gt;   income             </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;              </span></span>
<span><span class="co">#&gt; 1 Low income         </span></span>
<span><span class="co">#&gt; 2 Upper middle income</span></span>
<span><span class="co">#&gt; 3 Lower middle income</span></span>
<span><span class="co">#&gt; 4 High income        </span></span>
<span><span class="co">#&gt; 5 Not classified</span></span></code></pre></div>
<p>NA もなくなりましたから、あとは、Not classified ですね。</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">!=</span> <span class="st">"Aggregates"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">==</span> <span class="st">"Not classified"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   country      </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        </span></span>
<span><span class="co">#&gt; 1 Venezuela, RB</span></span></code></pre></div>
<p>ベネズエラ（Venezuela, RB）は、経済が安定していないので、このようになるようです。これは、残しておいて、Aggregates でないものだけ選択しましょう。通常の、country のみですから、<code>df_wdi3c</code> としておきます。</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">&lt;-</span> <span class="va">df_wdi3</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">income</span> <span class="op">!=</span> <span class="st">"Aggregates"</span><span class="op">)</span> </span>
<span><span class="va">df_wdi3c</span></span>
<span><span class="co">#&gt; # A tibble: 13,608 × 8</span></span>
<span><span class="co">#&gt;    country     iso2c  year lifeExp      pop gdpPercap income</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1 Afghanistan AF     2014    62.5 32716210      603. Low i…</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF     2012    61.9 30466479      596. Low i…</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF     2009    60.4 27385307      512. Low i…</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF     2013    62.4 31541209      608. Low i…</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF     1971    37.9 11015857       NA  Low i…</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF     2015    62.7 33753499      592. Low i…</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF     1969    36.9 10494489       NA  Low i…</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF     2010    60.9 28189672      569. Low i…</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF     2011    61.4 29249157      551. Low i…</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF     2008    59.9 26427199      437. Low i…</span></span>
<span><span class="co">#&gt; # ℹ 13,598 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: region &lt;chr&gt;</span></span></code></pre></div>
<p>散布図を書いてみましょう。</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3998 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-41-1.png" width="672"></div>
<p>一応、なにか描けましたが、どうも、すごく点の数が多いですね。それと、欠損値もたくさんあるようです。また、gdpPercap でみると、値が小さいところに固まってあるようです。</p>
<p>まずは、すべての年について、値を使っていますから、2022 年に限ってみましょう。</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="st">"2022"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 216 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-42-1.png" width="672"></div>
<p>どうも、何も現れません。2021 年ならどうでしょうか。</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 22 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-43-1.png" width="672"></div>
<p>データがない国もあるようですが、どうやら表示されました。データがない国は、削除しておいたり region を 色で表したり、人口を、点の大きさで表したり、gdpPercap を log10 をとって、値を修正して表すなども可能ですが、それは、可視化の項目で学びます。</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span>, <span class="va">gdpPercap</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">region</span>, size <span class="op">=</span> <span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-44-1.png" width="672"></div>
<p>こうしてみると、gdpPercap が大きい国ほど、lifeExp も大きい傾向があることも見えますね。</p>
<p>ここまでは、<code>select</code> と、<code>filter</code> を使ってきましたが、<code>arrange</code>、<code>mutate</code>、<code>group_by</code> や、<code>summarize</code> も使ってみましょう。</p>
<p>まず、gdpPercap は一人当たりの GDP でしたから、この値に、pop 人口をかければ、原理的には、GDP が得られることになります。（さまざまな基準がありますから、詳細は、調べてください。）順番を、入れ替えて、year の次に、gdp がくるようにしておきます。他にも、year の後に置くようにとの指示もできます。Help で確認してください。例も載っています。また、掛け算は、* を使います。これを、df_wdi4c としておきましょう。また、year が順番になっていないのが気になりますから、大きい順に並べ替えておきましょう。</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi4c</span> <span class="op">&lt;-</span> <span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp <span class="op">=</span> <span class="va">pop</span><span class="op">*</span><span class="va">gdpPercap</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">9</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">country</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_wdi4c</span></span>
<span><span class="co">#&gt; # A tibble: 13,608 × 9</span></span>
<span><span class="co">#&gt;    country     iso2c  year      gdp lifeExp    pop gdpPercap</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Afghanistan AF     2022 NA          NA   4.11e7       NA </span></span>
<span><span class="co">#&gt;  2 Afghanistan AF     2021  1.71e10    62.0 4.01e7      426.</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF     2020  2.16e10    62.6 3.90e7      553.</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF     2019  2.21e10    63.6 3.78e7      584.</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF     2018  2.12e10    63.1 3.67e7      579.</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF     2017  2.10e10    63.0 3.56e7      589.</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF     2016  2.05e10    63.1 3.46e7      590.</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF     2015  2.00e10    62.7 3.38e7      592.</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF     2014  1.97e10    62.5 3.27e7      603.</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF     2013  1.92e10    62.4 3.15e7      608.</span></span>
<span><span class="co">#&gt; # ℹ 13,598 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: income &lt;chr&gt;, region &lt;chr&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi3c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdp <span class="op">=</span> <span class="va">pop</span><span class="op">*</span><span class="va">gdpPercap</span>, .after <span class="op">=</span> <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">country</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 13,608 × 9</span></span>
<span><span class="co">#&gt;    country     iso2c  year      gdp lifeExp    pop gdpPercap</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Afghanistan AF     2022 NA          NA   4.11e7       NA </span></span>
<span><span class="co">#&gt;  2 Afghanistan AF     2021  1.71e10    62.0 4.01e7      426.</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF     2020  2.16e10    62.6 3.90e7      553.</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF     2019  2.21e10    63.6 3.78e7      584.</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF     2018  2.12e10    63.1 3.67e7      579.</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF     2017  2.10e10    63.0 3.56e7      589.</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF     2016  2.05e10    63.1 3.46e7      590.</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF     2015  2.00e10    62.7 3.38e7      592.</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF     2014  1.97e10    62.5 3.27e7      603.</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF     2013  1.92e10    62.4 3.15e7      608.</span></span>
<span><span class="co">#&gt; # ℹ 13,598 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: income &lt;chr&gt;, region &lt;chr&gt;</span></span></code></pre></div>
<p>2022 年のデータはあまりないようですから、2021 年の GDP の大きい順に並べてみましょう。gdp が　2.052946e13 などと書かれているのは、指数表示（Scientific Notation）で、e3 は、1000 千、e6 は、1,000,000 百万、e9 は、1,000,000,000 千億、e12 は、1,000,000,000,000 超です。つまり、アメリカの GDP は、だいたい、20兆ドル、日本は、4.5兆ドルと言ったところです。</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi4c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 216 × 9</span></span>
<span><span class="co">#&gt;    country      iso2c  year     gdp lifeExp    pop gdpPercap</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 United Stat… US     2021 2.05e13    76.3 3.32e8    61830.</span></span>
<span><span class="co">#&gt;  2 China        CN     2021 1.59e13    78.2 1.41e9    11223.</span></span>
<span><span class="co">#&gt;  3 Japan        JP     2021 4.46e12    84.4 1.26e8    35508.</span></span>
<span><span class="co">#&gt;  4 Germany      DE     2021 3.55e12    80.9 8.32e7    42726.</span></span>
<span><span class="co">#&gt;  5 United King… GB     2021 3.04e12    80.7 6.70e7    45334.</span></span>
<span><span class="co">#&gt;  6 India        IN     2021 2.76e12    67.2 1.41e9     1962.</span></span>
<span><span class="co">#&gt;  7 France       FR     2021 2.58e12    82.3 6.77e7    38046.</span></span>
<span><span class="co">#&gt;  8 Italy        IT     2021 1.87e12    82.8 5.91e7    31601.</span></span>
<span><span class="co">#&gt;  9 Brazil       BR     2021 1.85e12    72.8 2.14e8     8622.</span></span>
<span><span class="co">#&gt; 10 Korea, Rep.  KR     2021 1.69e12    83.5 5.17e7    32731.</span></span>
<span><span class="co">#&gt; # ℹ 206 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: income &lt;chr&gt;, region &lt;chr&gt;</span></span></code></pre></div>
<p>地域ごとの平均寿命を求めてみましょう。</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi4c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lifeexpregion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">lifeexpregion</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span><span class="co">#&gt;   region                     lifeexpregion</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                              &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 North America                       75.6</span></span>
<span><span class="co">#&gt; 2 Europe &amp; Central Asia               72.2</span></span>
<span><span class="co">#&gt; 3 Latin America &amp; Caribbean           68.3</span></span>
<span><span class="co">#&gt; 4 Middle East &amp; North Africa          66.2</span></span>
<span><span class="co">#&gt; 5 East Asia &amp; Pacific                 66.0</span></span>
<span><span class="co">#&gt; 6 South Asia                          58.1</span></span>
<span><span class="co">#&gt; 7 Sub-Saharan Africa                  52.1</span></span></code></pre></div>
<p>income でも計算してみましょう。</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi4c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>lifeexpincome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">lifeexpincome</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co">#&gt;   income              lifeexpincome</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 High income                  73.4</span></span>
<span><span class="co">#&gt; 2 Not classified               69.2</span></span>
<span><span class="co">#&gt; 3 Upper middle income          66.4</span></span>
<span><span class="co">#&gt; 4 Lower middle income          58.8</span></span>
<span><span class="co">#&gt; 5 Low income                   50.1</span></span></code></pre></div>
<p>ある年の値がないためにグラフがかけない場合もあります。各指標の年毎のデータがどれぐらいあるかみてみましょう。<code>is.na(x)</code> は、x が NA なら TRUE （値は 1）、x が NA でなければ、FALSE（値は 0）を返します。<code>!is.na(x)</code> はその否定ですから、逆になります。そこで、たとえば、<code>sum(!is.na(gdp))</code> は、gdp という列（年毎にグループ分けした）の中の、NA ではないものがいくつあるか数えることになります。sum は summation で、合計です。</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi4c</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>gdp_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gdp</span><span class="op">)</span><span class="op">)</span>, lifeExp_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span>, pop_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span>, gdpPercap_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gdpPercap</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 63 × 5</span></span>
<span><span class="co">#&gt;     year gdp_n lifeExp_n pop_n gdpPercap_n</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  2022   185         0   216         185</span></span>
<span><span class="co">#&gt;  2  2021   201       208   216         201</span></span>
<span><span class="co">#&gt;  3  2020   206       208   216         206</span></span>
<span><span class="co">#&gt;  4  2019   206       208   216         206</span></span>
<span><span class="co">#&gt;  5  2018   206       208   216         206</span></span>
<span><span class="co">#&gt;  6  2017   206       209   216         206</span></span>
<span><span class="co">#&gt;  7  2016   206       209   216         206</span></span>
<span><span class="co">#&gt;  8  2015   209       209   216         209</span></span>
<span><span class="co">#&gt;  9  2014   207       209   216         207</span></span>
<span><span class="co">#&gt; 10  2013   207       209   216         207</span></span>
<span><span class="co">#&gt; # ℹ 53 more rows</span></span></code></pre></div>
</div>
<div id="filter" class="section level3" number="18.4.4">
<h3>
<span class="header-section-number">18.4.4</span> <code>filter</code><a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p>一番上に、国名（country）に、アフガニスタン（Afghanistan） がありましたから、aアフガニスタンのデータを選び、平均寿命（lifeExp: Life Expectancy）の折線グラフ（line graph）を描いてみましょう。まずは、filter で、アフガニスタンのデータを抽出します。スペルに注意してください。コピーをするのが安全かもしれません。フ（line graph）を描いてみましょう。まずは、filter で、アフガニスタンのデータを抽出します。スペルに注意してください。コピーをするのが安全かもしれません。</p>
<p><code>filter(country == "Afghanistan")</code></p>
<p>特定の値のデータを抽出するには、<code>==</code> を使うのでした。二つの <code>=</code> ですから、間違わないでください。</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Afghanistan"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 63 × 7</span></span>
<span><span class="co">#&gt;    country     iso2c iso3c  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Afghanistan AF    AFG    1960    32.5  8622466        NA</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF    AFG    1961    33.1  8790140        NA</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF    AFG    1962    33.5  8969047        NA</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF    AFG    1963    34.0  9157465        NA</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF    AFG    1964    34.5  9355514        NA</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF    AFG    1965    35.0  9565147        NA</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF    AFG    1966    35.5  9783147        NA</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF    AFG    1967    35.9 10010030        NA</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF    AFG    1968    36.4 10247780        NA</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF    AFG    1969    36.9 10494489        NA</span></span>
<span><span class="co">#&gt; # ℹ 53 more rows</span></span></code></pre></div>
<p>確認できましたか。</p>
<p>折線グラフを書きます。この場合は、GEOM は、<code>geom_line</code> です。</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Afghanistan"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-52-1.png" width="672"></div>
<p>アフガニスタンでは 1952年 の誕生時の平均寿命（life expectancy at birth）は　30歳以下 （28.8歳）でした。2007年でも50歳以下（48.8 歳）のようですね。改善されていることも確かです。</p>
<p>アフガニスタンと日本両方を抽出してみましょう。そのときは、 <code>country %in% c("Afghanistan", "Japan")</code>　とします。</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Afghanistan"</span>, <span class="st">"Japan"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 126 × 7</span></span>
<span><span class="co">#&gt;    country     iso2c iso3c  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Afghanistan AF    AFG    1960    32.5  8622466        NA</span></span>
<span><span class="co">#&gt;  2 Afghanistan AF    AFG    1961    33.1  8790140        NA</span></span>
<span><span class="co">#&gt;  3 Afghanistan AF    AFG    1962    33.5  8969047        NA</span></span>
<span><span class="co">#&gt;  4 Afghanistan AF    AFG    1963    34.0  9157465        NA</span></span>
<span><span class="co">#&gt;  5 Afghanistan AF    AFG    1964    34.5  9355514        NA</span></span>
<span><span class="co">#&gt;  6 Afghanistan AF    AFG    1965    35.0  9565147        NA</span></span>
<span><span class="co">#&gt;  7 Afghanistan AF    AFG    1966    35.5  9783147        NA</span></span>
<span><span class="co">#&gt;  8 Afghanistan AF    AFG    1967    35.9 10010030        NA</span></span>
<span><span class="co">#&gt;  9 Afghanistan AF    AFG    1968    36.4 10247780        NA</span></span>
<span><span class="co">#&gt; 10 Afghanistan AF    AFG    1969    36.9 10494489        NA</span></span>
<span><span class="co">#&gt; # ℹ 116 more rows</span></span></code></pre></div>
<p>グラフにしてみましょう。今度は、区別のため、<code>color = country</code> を追加します。すると、線が違う色で表示されます。詳しくは、視覚化を参照してください。</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Afghanistan"</span>, <span class="st">"Japan"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-54-1.png" width="672"></div>
<p>どのような発見がありますか。かならず書き留めておいてください。</p>
<p>他の国についても調べるときは、国のリストがあるとよいので、 <code>unique(df_gm$country)</code> とすると、リストが得られます。<code>distinct(country)</code> で、異なる国を選択してから、その部分をベクトルとして出力することもできます。</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "Afghanistan"                                         </span></span>
<span><span class="co">#&gt;   [2] "Africa Eastern and Southern"                         </span></span>
<span><span class="co">#&gt;   [3] "Africa Western and Central"                          </span></span>
<span><span class="co">#&gt;   [4] "Albania"                                             </span></span>
<span><span class="co">#&gt;   [5] "Algeria"                                             </span></span>
<span><span class="co">#&gt;   [6] "American Samoa"                                      </span></span>
<span><span class="co">#&gt;   [7] "Andorra"                                             </span></span>
<span><span class="co">#&gt;   [8] "Angola"                                              </span></span>
<span><span class="co">#&gt;   [9] "Antigua and Barbuda"                                 </span></span>
<span><span class="co">#&gt;  [10] "Arab World"                                          </span></span>
<span><span class="co">#&gt;  [11] "Argentina"                                           </span></span>
<span><span class="co">#&gt;  [12] "Armenia"                                             </span></span>
<span><span class="co">#&gt;  [13] "Aruba"                                               </span></span>
<span><span class="co">#&gt;  [14] "Australia"                                           </span></span>
<span><span class="co">#&gt;  [15] "Austria"                                             </span></span>
<span><span class="co">#&gt;  [16] "Azerbaijan"                                          </span></span>
<span><span class="co">#&gt;  [17] "Bahamas, The"                                        </span></span>
<span><span class="co">#&gt;  [18] "Bahrain"                                             </span></span>
<span><span class="co">#&gt;  [19] "Bangladesh"                                          </span></span>
<span><span class="co">#&gt;  [20] "Barbados"                                            </span></span>
<span><span class="co">#&gt;  [21] "Belarus"                                             </span></span>
<span><span class="co">#&gt;  [22] "Belgium"                                             </span></span>
<span><span class="co">#&gt;  [23] "Belize"                                              </span></span>
<span><span class="co">#&gt;  [24] "Benin"                                               </span></span>
<span><span class="co">#&gt;  [25] "Bermuda"                                             </span></span>
<span><span class="co">#&gt;  [26] "Bhutan"                                              </span></span>
<span><span class="co">#&gt;  [27] "Bolivia"                                             </span></span>
<span><span class="co">#&gt;  [28] "Bosnia and Herzegovina"                              </span></span>
<span><span class="co">#&gt;  [29] "Botswana"                                            </span></span>
<span><span class="co">#&gt;  [30] "Brazil"                                              </span></span>
<span><span class="co">#&gt;  [31] "British Virgin Islands"                              </span></span>
<span><span class="co">#&gt;  [32] "Brunei Darussalam"                                   </span></span>
<span><span class="co">#&gt;  [33] "Bulgaria"                                            </span></span>
<span><span class="co">#&gt;  [34] "Burkina Faso"                                        </span></span>
<span><span class="co">#&gt;  [35] "Burundi"                                             </span></span>
<span><span class="co">#&gt;  [36] "Cabo Verde"                                          </span></span>
<span><span class="co">#&gt;  [37] "Cambodia"                                            </span></span>
<span><span class="co">#&gt;  [38] "Cameroon"                                            </span></span>
<span><span class="co">#&gt;  [39] "Canada"                                              </span></span>
<span><span class="co">#&gt;  [40] "Caribbean small states"                              </span></span>
<span><span class="co">#&gt;  [41] "Cayman Islands"                                      </span></span>
<span><span class="co">#&gt;  [42] "Central African Republic"                            </span></span>
<span><span class="co">#&gt;  [43] "Central Europe and the Baltics"                      </span></span>
<span><span class="co">#&gt;  [44] "Chad"                                                </span></span>
<span><span class="co">#&gt;  [45] "Channel Islands"                                     </span></span>
<span><span class="co">#&gt;  [46] "Chile"                                               </span></span>
<span><span class="co">#&gt;  [47] "China"                                               </span></span>
<span><span class="co">#&gt;  [48] "Colombia"                                            </span></span>
<span><span class="co">#&gt;  [49] "Comoros"                                             </span></span>
<span><span class="co">#&gt;  [50] "Congo, Dem. Rep."                                    </span></span>
<span><span class="co">#&gt;  [51] "Congo, Rep."                                         </span></span>
<span><span class="co">#&gt;  [52] "Costa Rica"                                          </span></span>
<span><span class="co">#&gt;  [53] "Cote d'Ivoire"                                       </span></span>
<span><span class="co">#&gt;  [54] "Croatia"                                             </span></span>
<span><span class="co">#&gt;  [55] "Cuba"                                                </span></span>
<span><span class="co">#&gt;  [56] "Curacao"                                             </span></span>
<span><span class="co">#&gt;  [57] "Cyprus"                                              </span></span>
<span><span class="co">#&gt;  [58] "Czechia"                                             </span></span>
<span><span class="co">#&gt;  [59] "Denmark"                                             </span></span>
<span><span class="co">#&gt;  [60] "Djibouti"                                            </span></span>
<span><span class="co">#&gt;  [61] "Dominica"                                            </span></span>
<span><span class="co">#&gt;  [62] "Dominican Republic"                                  </span></span>
<span><span class="co">#&gt;  [63] "Early-demographic dividend"                          </span></span>
<span><span class="co">#&gt;  [64] "East Asia &amp; Pacific"                                 </span></span>
<span><span class="co">#&gt;  [65] "East Asia &amp; Pacific (excluding high income)"         </span></span>
<span><span class="co">#&gt;  [66] "East Asia &amp; Pacific (IDA &amp; IBRD countries)"          </span></span>
<span><span class="co">#&gt;  [67] "Ecuador"                                             </span></span>
<span><span class="co">#&gt;  [68] "Egypt, Arab Rep."                                    </span></span>
<span><span class="co">#&gt;  [69] "El Salvador"                                         </span></span>
<span><span class="co">#&gt;  [70] "Equatorial Guinea"                                   </span></span>
<span><span class="co">#&gt;  [71] "Eritrea"                                             </span></span>
<span><span class="co">#&gt;  [72] "Estonia"                                             </span></span>
<span><span class="co">#&gt;  [73] "Eswatini"                                            </span></span>
<span><span class="co">#&gt;  [74] "Ethiopia"                                            </span></span>
<span><span class="co">#&gt;  [75] "Euro area"                                           </span></span>
<span><span class="co">#&gt;  [76] "Europe &amp; Central Asia"                               </span></span>
<span><span class="co">#&gt;  [77] "Europe &amp; Central Asia (excluding high income)"       </span></span>
<span><span class="co">#&gt;  [78] "Europe &amp; Central Asia (IDA &amp; IBRD countries)"        </span></span>
<span><span class="co">#&gt;  [79] "European Union"                                      </span></span>
<span><span class="co">#&gt;  [80] "Faroe Islands"                                       </span></span>
<span><span class="co">#&gt;  [81] "Fiji"                                                </span></span>
<span><span class="co">#&gt;  [82] "Finland"                                             </span></span>
<span><span class="co">#&gt;  [83] "Fragile and conflict affected situations"            </span></span>
<span><span class="co">#&gt;  [84] "France"                                              </span></span>
<span><span class="co">#&gt;  [85] "French Polynesia"                                    </span></span>
<span><span class="co">#&gt;  [86] "Gabon"                                               </span></span>
<span><span class="co">#&gt;  [87] "Gambia, The"                                         </span></span>
<span><span class="co">#&gt;  [88] "Georgia"                                             </span></span>
<span><span class="co">#&gt;  [89] "Germany"                                             </span></span>
<span><span class="co">#&gt;  [90] "Ghana"                                               </span></span>
<span><span class="co">#&gt;  [91] "Gibraltar"                                           </span></span>
<span><span class="co">#&gt;  [92] "Greece"                                              </span></span>
<span><span class="co">#&gt;  [93] "Greenland"                                           </span></span>
<span><span class="co">#&gt;  [94] "Grenada"                                             </span></span>
<span><span class="co">#&gt;  [95] "Guam"                                                </span></span>
<span><span class="co">#&gt;  [96] "Guatemala"                                           </span></span>
<span><span class="co">#&gt;  [97] "Guinea"                                              </span></span>
<span><span class="co">#&gt;  [98] "Guinea-Bissau"                                       </span></span>
<span><span class="co">#&gt;  [99] "Guyana"                                              </span></span>
<span><span class="co">#&gt; [100] "Haiti"                                               </span></span>
<span><span class="co">#&gt; [101] "Heavily indebted poor countries (HIPC)"              </span></span>
<span><span class="co">#&gt; [102] "High income"                                         </span></span>
<span><span class="co">#&gt; [103] "Honduras"                                            </span></span>
<span><span class="co">#&gt; [104] "Hong Kong SAR, China"                                </span></span>
<span><span class="co">#&gt; [105] "Hungary"                                             </span></span>
<span><span class="co">#&gt; [106] "IBRD only"                                           </span></span>
<span><span class="co">#&gt; [107] "Iceland"                                             </span></span>
<span><span class="co">#&gt; [108] "IDA &amp; IBRD total"                                    </span></span>
<span><span class="co">#&gt; [109] "IDA blend"                                           </span></span>
<span><span class="co">#&gt; [110] "IDA only"                                            </span></span>
<span><span class="co">#&gt; [111] "IDA total"                                           </span></span>
<span><span class="co">#&gt; [112] "India"                                               </span></span>
<span><span class="co">#&gt; [113] "Indonesia"                                           </span></span>
<span><span class="co">#&gt; [114] "Iran, Islamic Rep."                                  </span></span>
<span><span class="co">#&gt; [115] "Iraq"                                                </span></span>
<span><span class="co">#&gt; [116] "Ireland"                                             </span></span>
<span><span class="co">#&gt; [117] "Isle of Man"                                         </span></span>
<span><span class="co">#&gt; [118] "Israel"                                              </span></span>
<span><span class="co">#&gt; [119] "Italy"                                               </span></span>
<span><span class="co">#&gt; [120] "Jamaica"                                             </span></span>
<span><span class="co">#&gt; [121] "Japan"                                               </span></span>
<span><span class="co">#&gt; [122] "Jordan"                                              </span></span>
<span><span class="co">#&gt; [123] "Kazakhstan"                                          </span></span>
<span><span class="co">#&gt; [124] "Kenya"                                               </span></span>
<span><span class="co">#&gt; [125] "Kiribati"                                            </span></span>
<span><span class="co">#&gt; [126] "Korea, Dem. People's Rep."                           </span></span>
<span><span class="co">#&gt; [127] "Korea, Rep."                                         </span></span>
<span><span class="co">#&gt; [128] "Kosovo"                                              </span></span>
<span><span class="co">#&gt; [129] "Kuwait"                                              </span></span>
<span><span class="co">#&gt; [130] "Kyrgyz Republic"                                     </span></span>
<span><span class="co">#&gt; [131] "Lao PDR"                                             </span></span>
<span><span class="co">#&gt; [132] "Late-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [133] "Latin America &amp; Caribbean"                           </span></span>
<span><span class="co">#&gt; [134] "Latin America &amp; Caribbean (excluding high income)"   </span></span>
<span><span class="co">#&gt; [135] "Latin America &amp; the Caribbean (IDA &amp; IBRD countries)"</span></span>
<span><span class="co">#&gt; [136] "Latvia"                                              </span></span>
<span><span class="co">#&gt; [137] "Least developed countries: UN classification"        </span></span>
<span><span class="co">#&gt; [138] "Lebanon"                                             </span></span>
<span><span class="co">#&gt; [139] "Lesotho"                                             </span></span>
<span><span class="co">#&gt; [140] "Liberia"                                             </span></span>
<span><span class="co">#&gt; [141] "Libya"                                               </span></span>
<span><span class="co">#&gt; [142] "Liechtenstein"                                       </span></span>
<span><span class="co">#&gt; [143] "Lithuania"                                           </span></span>
<span><span class="co">#&gt; [144] "Low &amp; middle income"                                 </span></span>
<span><span class="co">#&gt; [145] "Low income"                                          </span></span>
<span><span class="co">#&gt; [146] "Lower middle income"                                 </span></span>
<span><span class="co">#&gt; [147] "Luxembourg"                                          </span></span>
<span><span class="co">#&gt; [148] "Macao SAR, China"                                    </span></span>
<span><span class="co">#&gt; [149] "Madagascar"                                          </span></span>
<span><span class="co">#&gt; [150] "Malawi"                                              </span></span>
<span><span class="co">#&gt; [151] "Malaysia"                                            </span></span>
<span><span class="co">#&gt; [152] "Maldives"                                            </span></span>
<span><span class="co">#&gt; [153] "Mali"                                                </span></span>
<span><span class="co">#&gt; [154] "Malta"                                               </span></span>
<span><span class="co">#&gt; [155] "Marshall Islands"                                    </span></span>
<span><span class="co">#&gt; [156] "Mauritania"                                          </span></span>
<span><span class="co">#&gt; [157] "Mauritius"                                           </span></span>
<span><span class="co">#&gt; [158] "Mexico"                                              </span></span>
<span><span class="co">#&gt; [159] "Micronesia, Fed. Sts."                               </span></span>
<span><span class="co">#&gt; [160] "Middle East &amp; North Africa"                          </span></span>
<span><span class="co">#&gt; [161] "Middle East &amp; North Africa (excluding high income)"  </span></span>
<span><span class="co">#&gt; [162] "Middle East &amp; North Africa (IDA &amp; IBRD countries)"   </span></span>
<span><span class="co">#&gt; [163] "Middle income"                                       </span></span>
<span><span class="co">#&gt; [164] "Moldova"                                             </span></span>
<span><span class="co">#&gt; [165] "Monaco"                                              </span></span>
<span><span class="co">#&gt; [166] "Mongolia"                                            </span></span>
<span><span class="co">#&gt; [167] "Montenegro"                                          </span></span>
<span><span class="co">#&gt; [168] "Morocco"                                             </span></span>
<span><span class="co">#&gt; [169] "Mozambique"                                          </span></span>
<span><span class="co">#&gt; [170] "Myanmar"                                             </span></span>
<span><span class="co">#&gt; [171] "Namibia"                                             </span></span>
<span><span class="co">#&gt; [172] "Nauru"                                               </span></span>
<span><span class="co">#&gt; [173] "Nepal"                                               </span></span>
<span><span class="co">#&gt; [174] "Netherlands"                                         </span></span>
<span><span class="co">#&gt; [175] "New Caledonia"                                       </span></span>
<span><span class="co">#&gt; [176] "New Zealand"                                         </span></span>
<span><span class="co">#&gt; [177] "Nicaragua"                                           </span></span>
<span><span class="co">#&gt; [178] "Niger"                                               </span></span>
<span><span class="co">#&gt; [179] "Nigeria"                                             </span></span>
<span><span class="co">#&gt; [180] "North America"                                       </span></span>
<span><span class="co">#&gt; [181] "North Macedonia"                                     </span></span>
<span><span class="co">#&gt; [182] "Northern Mariana Islands"                            </span></span>
<span><span class="co">#&gt; [183] "Norway"                                              </span></span>
<span><span class="co">#&gt; [184] "Not classified"                                      </span></span>
<span><span class="co">#&gt; [185] "OECD members"                                        </span></span>
<span><span class="co">#&gt; [186] "Oman"                                                </span></span>
<span><span class="co">#&gt; [187] "Other small states"                                  </span></span>
<span><span class="co">#&gt; [188] "Pacific island small states"                         </span></span>
<span><span class="co">#&gt; [189] "Pakistan"                                            </span></span>
<span><span class="co">#&gt; [190] "Palau"                                               </span></span>
<span><span class="co">#&gt; [191] "Panama"                                              </span></span>
<span><span class="co">#&gt; [192] "Papua New Guinea"                                    </span></span>
<span><span class="co">#&gt; [193] "Paraguay"                                            </span></span>
<span><span class="co">#&gt; [194] "Peru"                                                </span></span>
<span><span class="co">#&gt; [195] "Philippines"                                         </span></span>
<span><span class="co">#&gt; [196] "Poland"                                              </span></span>
<span><span class="co">#&gt; [197] "Portugal"                                            </span></span>
<span><span class="co">#&gt; [198] "Post-demographic dividend"                           </span></span>
<span><span class="co">#&gt; [199] "Pre-demographic dividend"                            </span></span>
<span><span class="co">#&gt; [200] "Puerto Rico"                                         </span></span>
<span><span class="co">#&gt; [201] "Qatar"                                               </span></span>
<span><span class="co">#&gt; [202] "Romania"                                             </span></span>
<span><span class="co">#&gt; [203] "Russian Federation"                                  </span></span>
<span><span class="co">#&gt; [204] "Rwanda"                                              </span></span>
<span><span class="co">#&gt; [205] "Samoa"                                               </span></span>
<span><span class="co">#&gt; [206] "San Marino"                                          </span></span>
<span><span class="co">#&gt; [207] "Sao Tome and Principe"                               </span></span>
<span><span class="co">#&gt; [208] "Saudi Arabia"                                        </span></span>
<span><span class="co">#&gt; [209] "Senegal"                                             </span></span>
<span><span class="co">#&gt; [210] "Serbia"                                              </span></span>
<span><span class="co">#&gt; [211] "Seychelles"                                          </span></span>
<span><span class="co">#&gt; [212] "Sierra Leone"                                        </span></span>
<span><span class="co">#&gt; [213] "Singapore"                                           </span></span>
<span><span class="co">#&gt; [214] "Sint Maarten (Dutch part)"                           </span></span>
<span><span class="co">#&gt; [215] "Slovak Republic"                                     </span></span>
<span><span class="co">#&gt; [216] "Slovenia"                                            </span></span>
<span><span class="co">#&gt; [217] "Small states"                                        </span></span>
<span><span class="co">#&gt; [218] "Solomon Islands"                                     </span></span>
<span><span class="co">#&gt; [219] "Somalia"                                             </span></span>
<span><span class="co">#&gt; [220] "South Africa"                                        </span></span>
<span><span class="co">#&gt; [221] "South Asia"                                          </span></span>
<span><span class="co">#&gt; [222] "South Asia (IDA &amp; IBRD)"                             </span></span>
<span><span class="co">#&gt; [223] "South Sudan"                                         </span></span>
<span><span class="co">#&gt; [224] "Spain"                                               </span></span>
<span><span class="co">#&gt; [225] "Sri Lanka"                                           </span></span>
<span><span class="co">#&gt; [226] "St. Kitts and Nevis"                                 </span></span>
<span><span class="co">#&gt; [227] "St. Lucia"                                           </span></span>
<span><span class="co">#&gt; [228] "St. Martin (French part)"                            </span></span>
<span><span class="co">#&gt; [229] "St. Vincent and the Grenadines"                      </span></span>
<span><span class="co">#&gt; [230] "Sub-Saharan Africa"                                  </span></span>
<span><span class="co">#&gt; [231] "Sub-Saharan Africa (excluding high income)"          </span></span>
<span><span class="co">#&gt; [232] "Sub-Saharan Africa (IDA &amp; IBRD countries)"           </span></span>
<span><span class="co">#&gt; [233] "Sudan"                                               </span></span>
<span><span class="co">#&gt; [234] "Suriname"                                            </span></span>
<span><span class="co">#&gt; [235] "Sweden"                                              </span></span>
<span><span class="co">#&gt; [236] "Switzerland"                                         </span></span>
<span><span class="co">#&gt; [237] "Syrian Arab Republic"                                </span></span>
<span><span class="co">#&gt; [238] "Tajikistan"                                          </span></span>
<span><span class="co">#&gt; [239] "Tanzania"                                            </span></span>
<span><span class="co">#&gt; [240] "Thailand"                                            </span></span>
<span><span class="co">#&gt; [241] "Timor-Leste"                                         </span></span>
<span><span class="co">#&gt; [242] "Togo"                                                </span></span>
<span><span class="co">#&gt; [243] "Tonga"                                               </span></span>
<span><span class="co">#&gt; [244] "Trinidad and Tobago"                                 </span></span>
<span><span class="co">#&gt; [245] "Tunisia"                                             </span></span>
<span><span class="co">#&gt; [246] "Turkiye"                                             </span></span>
<span><span class="co">#&gt; [247] "Turkmenistan"                                        </span></span>
<span><span class="co">#&gt; [248] "Turks and Caicos Islands"                            </span></span>
<span><span class="co">#&gt; [249] "Tuvalu"                                              </span></span>
<span><span class="co">#&gt; [250] "Uganda"                                              </span></span>
<span><span class="co">#&gt; [251] "Ukraine"                                             </span></span>
<span><span class="co">#&gt; [252] "United Arab Emirates"                                </span></span>
<span><span class="co">#&gt; [253] "United Kingdom"                                      </span></span>
<span><span class="co">#&gt; [254] "United States"                                       </span></span>
<span><span class="co">#&gt; [255] "Upper middle income"                                 </span></span>
<span><span class="co">#&gt; [256] "Uruguay"                                             </span></span>
<span><span class="co">#&gt; [257] "Uzbekistan"                                          </span></span>
<span><span class="co">#&gt; [258] "Vanuatu"                                             </span></span>
<span><span class="co">#&gt; [259] "Venezuela, RB"                                       </span></span>
<span><span class="co">#&gt; [260] "Vietnam"                                             </span></span>
<span><span class="co">#&gt; [261] "Virgin Islands (U.S.)"                               </span></span>
<span><span class="co">#&gt; [262] "West Bank and Gaza"                                  </span></span>
<span><span class="co">#&gt; [263] "World"                                               </span></span>
<span><span class="co">#&gt; [264] "Yemen, Rep."                                         </span></span>
<span><span class="co">#&gt; [265] "Zambia"                                              </span></span>
<span><span class="co">#&gt; [266] "Zimbabwe"</span></span></code></pre></div>
<p>このデータには 142 の国のデータがあることがわかりました。</p>
<p>BRICs を選んでみるとどうなるでしょうか。最近は、BRICS として、South Africa を加えることが増えてきているようです。</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Brazil"</span>, <span class="st">"Russia"</span>, <span class="st">"India"</span>, <span class="st">"China"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="inline-figure"><img src="25-transform_files/figure-html/unnamed-chunk-56-1.png" width="672"></div>
<p>ロシアが含まれていないことがわかります。ロシアは、以前は、ソビエト社会主義連邦でしたから、国が変化したものは含まれていないのかもしれません。上の国のリストで見てもありませんね。2007年より新しいデータ、ロシアなども含むデータなど、実際のデータでも見てみたいですね。それは、また後ほど。</p>
</div>
<div id="練習-3" class="section level3" number="18.4.5">
<h3>
<span class="header-section-number">18.4.5</span> 練習<a class="anchor" aria-label="anchor" href="#%E7%B7%B4%E7%BF%92-3"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>平均寿命 <code>lifeExp</code> を人口 <code>pop</code> や、一人当たりの GDP <code>gdpPercap</code> に変えて、試してみてください。</li>
<li>ASEAN （東南アジア諸国連合）ではどうでしょうか。</li>
</ol>
<ul>
<li><p>Brunei, Cambodia, Indonesia, Laos, Malaysia, Myanmar, Philippines, Singapore.</p></li>
<li><p>このうち幾つの国がこのデータに含まれていますか。</p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>興味のある国をいくつか選んで、三つの指標について調べてみてください。</li>
</ol>
</div>
<div id="group_by-と-summarize" class="section level3" number="18.4.6">
<h3>
<span class="header-section-number">18.4.6</span> <code>group_by</code> と <code>summarize</code><a class="anchor" aria-label="anchor" href="#group_by-%E3%81%A8-summarize"><i class="fas fa-link"></i></a>
</h3>
<p>データには大陸（<code>continent</code> ）という変数があります。幾つの大陸があり、それぞれの大陸のいくつ国のデータがこのデータには入っているでしょうか。</p>
<p>それぞれの大陸ごとの2007年の平均寿命の平均と中央値と最大、最小を求めてみましょう。</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wdi_extra</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, median_lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, max_lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, min_lifeExp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 5</span></span>
<span><span class="co">#&gt; # Groups:   income [7]</span></span>
<span><span class="co">#&gt;   income mean_lifeExp median_lifeExp max_lifeExp min_lifeExp</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Aggre…         67.6           69.2        80.1        53.3</span></span>
<span><span class="co">#&gt; 2 High …         NA             NA          NA          NA  </span></span>
<span><span class="co">#&gt; 3 Low i…         56.9           55.4        73.7        47.4</span></span>
<span><span class="co">#&gt; 4 Lower…         64.4           65.9        77.1        43.1</span></span>
<span><span class="co">#&gt; 5 Not c…         73.1           73.1        73.1        73.1</span></span>
<span><span class="co">#&gt; 6 Upper…         NA             NA          NA          NA  </span></span>
<span><span class="co">#&gt; 7 &lt;NA&gt;           NA             NA          NA          NA</span></span></code></pre></div>
</div>
</div>
<div id="練習問題" class="section level2" number="18.5">
<h2>
<span class="header-section-number">18.5</span> 練習問題<a class="anchor" aria-label="anchor" href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C"><i class="fas fa-link"></i></a>
</h2>
<p><strong>R Markdown and <code>dplyr</code></strong></p>
<ul>
<li>Create an R Notebook of a Data Analysis containing the following and submit the rendered HTML file (eg. <code>a2_123456.nb.html</code>)
<ol style="list-style-type: decimal">
<li>create an R Notebook using the R Notebook Template in Moodle, save as <code>a2_123456.Rmd</code>,</li>
<li>write your name and ID and the contents,</li>
<li>run each code block,</li>
<li>preview to create <code>a2_123456.nb.html</code>,</li>
<li>submit <code>a2_123456.nb.html</code> to Moodle.</li>
</ol>
</li>
</ul>
<ol style="list-style-type: decimal">
<li>
<p>Pick data from the built-in datasets besides <code>cars</code>. (<code><a href="https://rdrr.io/r/base/library.html">library(help = "datasets")</a></code> or go to the site <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html">The R Datasets Package</a>)</p>
<ul>
<li>Information of the data: Name, Description, Usage, Format, Source, References (Hint: ?cars)</li>
<li>Use <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>, <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, …, and create at least one chart using <code>ggplot2</code> - Code Chunk.
<ul>
<li>Don’t forget to add <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> in the first code chunk.</li>
</ul>
</li>
<li>An observation of the chart - in your own words.</li>
</ul>
</li>
<li>
<p>Load <code>gapminder</code> by <code><a href="https://github.com/jennybc/gapminder">library(gapminder)</a></code>.</p>
<ul>
<li>Choose <code>pop</code> or <code>gdpPercap</code>, or both, one country in the data, a group of countries in the data.</li>
<li>Create charts using ggplot2 with geom_line and the variables and countries chosen in 1. (See examples of the charts for <code>lifeExp</code>.)</li>
<li>Study the data as you like.</li>
<li>Observations and difficulties encountered.</li>
</ul>
</li>
</ol>
<p>演習</p>
<div id="gapminder-と-r-package-gapminder" class="section level4" number="18.5.0.1">
<h4>
<span class="header-section-number">18.5.0.1</span> Gapminder と R Package <code>gapminder</code><a class="anchor" aria-label="anchor" href="#gapminder-%E3%81%A8-r-package-gapminder"><i class="fas fa-link"></i></a>
</h4>
<blockquote>
<p>Gapminder は オラ ロスリング（Ola Rosling） と アンナ ロスリング（Anna Rosling Rönnlund）と ハンス ロスリング（Hans Rosling）が設立した組織です。</p>
<p>ハンス・ロスリング は、<strong>FACTFULNESS（ファクトフルネス）10の思い込みを乗り越え、データを基に世界を正しく見る習慣</strong> の著者です。</p>
<p>また、R の gapminder パッケージには、ファクトフルネス にも登場するデータで、Gapminder サイトでも使っているデータの一部を、使いやすい、練習用のデータとして提供しているものです。</p>
</blockquote>
<ul>
<li>
<p>Gapminder: <a href="https://www.gapminder.org" class="uri">https://www.gapminder.org</a></p>
<ul>
<li>Test on Top: You are probably wrong about - upgrade your worldview</li>
<li>Bubble Chart: <a href="https://www.gapminder.org/tools/#%24chart-type=bubbles&amp;url=v1" class="uri">https://www.gapminder.org/tools/#$chart-type=bubbles&amp;url=v1</a>
</li>
<li>Dallar Street: <a href="https://www.gapminder.org/tools/#%24chart-type=bubbles&amp;url=v1" class="uri">https://www.gapminder.org/tools/#$chart-type=bubbles&amp;url=v1</a>
</li>
<li>Data: <a href="https://www.gapminder.org/data/" class="uri">https://www.gapminder.org/data/</a>
</li>
</ul>
</li>
<li>
<p>R Package gapminder by Jennifer Bryan</p>
<ul>
<li>Package site: <a href="https://CRAN.R-project.org/package=gapminder" class="uri">https://CRAN.R-project.org/package=gapminder</a>
</li>
<li>Site: <a href="https://github.com/jennybc/gapminder" class="uri">https://github.com/jennybc/gapminder</a>
</li>
<li>Documents: <a href="https://www.rdocumentation.org/packages/gapminder/versions/0.3.0" class="uri">https://www.rdocumentation.org/packages/gapminder/versions/0.3.0</a>
</li>
</ul>
</li>
<li>
<p>Package Help <code><a href="https://jennybc.github.io/gapminder/reference/gapminder.html">?gapminder</a></code> or <code>gapminder</code> in the search window of Help</p>
<ul>
<li>The main data frame gapminder has 1704 rows and 6 variables:
<ul>
<li>country: factor with 142 levels</li>
<li>continent: factor with 5 levels</li>
<li>year: ranges from 1952 to 2007 in increments of 5 years</li>
<li>lifeExp: life expectancy at birth, in years</li>
<li>pop: population</li>
<li>gdpPercap: GDP per capita (US$, inflation-adjusted)</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/WDI/">WDI</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="section" class="section level4" number="18.5.0.2">
<h4>
<span class="header-section-number">18.5.0.2</span> <a class="anchor" aria-label="anchor" href="#section"><i class="fas fa-link"></i></a>
</h4>

<hr>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="tidyverse.html"><span class="header-section-number">17</span> Tidyverse</a></div>
<div class="next"><a href="visualize.html"><span class="header-section-number">19</span> 視覚化（Visualize）</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#transform"><span class="header-section-number">18</span> 変形（Transform）</a></li>
<li>
<a class="nav-link" href="#dplyr-%E6%A6%82%E8%A6%81"><span class="header-section-number">18.1</span> dplyr 概要</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#select-%E5%90%8D%E5%89%8D%E3%81%A8%E3%82%BF%E3%82%A4%E3%83%97%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E5%88%97%E5%A4%89%E6%95%B0%E3%82%92%E9%81%B8%E6%8A%9E"><span class="header-section-number">18.1.1</span> select: 名前とタイプによって、列（変数）を選択</a></li>
<li><a class="nav-link" href="#filter-%E5%88%97%E3%81%AE%E5%80%A4%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%AB%E9%81%A9%E5%90%88%E3%81%97%E3%81%9F%E8%A1%8C%E3%81%AE%E9%81%B8%E6%8A%9E"><span class="header-section-number">18.1.2</span> filter: 列の値の条件に適合した行の選択</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">18.1.3</span> arrange</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">18.1.4</span> mutate</a></li>
<li><a class="nav-link" href="#group_by"><span class="header-section-number">18.1.5</span> group_by</a></li>
<li><a class="nav-link" href="#summarise-or-summarize"><span class="header-section-number">18.1.6</span> summarise or summarize</a></li>
<li><a class="nav-link" href="#%E3%83%91%E3%82%A4%E3%83%97pipe"><span class="header-section-number">18.1.7</span> パイプ（Pipe）%&gt;% |&gt;</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6-dplyr-i"><span class="header-section-number">18.2</span> 例から学ぶ dplyr, I</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-iris"><span class="header-section-number">18.2.1</span> Data iris</a></li>
<li><a class="nav-link" href="#select-%E5%88%97%E3%81%AE%E6%8A%BD%E5%87%BA"><span class="header-section-number">18.2.2</span> select 列の抽出</a></li>
<li><a class="nav-link" href="#select-1---%E7%AC%AC-1-2-5-%E5%88%97%E3%82%92%E6%8A%BD%E5%87%BA"><span class="header-section-number">18.2.3</span> select 1 - 第 1, 2, 5 列を抽出</a></li>
<li><a class="nav-link" href="#select-2---species-%E5%88%97%E4%BB%A5%E5%A4%96"><span class="header-section-number">18.2.4</span> select 2 - Species 列以外</a></li>
<li><a class="nav-link" href="#select-3---%E5%88%97%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E5%88%97%E5%90%8D%E3%82%82%E5%A4%89%E6%9B%B4"><span class="header-section-number">18.2.5</span> select 3 - 列を抽出するとともに列名も変更</a></li>
<li><a class="nav-link" href="#select-4---%E5%88%97%E9%A0%86%E3%81%AE%E5%A4%89%E6%9B%B4"><span class="header-section-number">18.2.6</span> select 4 - 列順の変更</a></li>
<li><a class="nav-link" href="#filter---%E5%80%A4%E3%81%AB%E3%82%88%E3%82%8B%E6%8A%BD%E5%87%BA"><span class="header-section-number">18.2.7</span> filter - 値による抽出</a></li>
<li><a class="nav-link" href="#arrange---%E6%98%87%E9%A0%86%E9%99%8D%E9%A0%86"><span class="header-section-number">18.2.8</span> arrange - 昇順、降順</a></li>
<li><a class="nav-link" href="#mutate---rank%E9%9A%8E%E7%B4%9A"><span class="header-section-number">18.2.9</span> mutate - rank（階級）</a></li>
<li><a class="nav-link" href="#group_by-and-summarize"><span class="header-section-number">18.2.10</span> group_by and summarize</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dplyr-%E3%81%AE%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="header-section-number">18.3</span> dplyr の参考文献</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#rstudio-primers-%E5%AF%BE%E8%A9%B1%E5%9E%8B%E3%81%AE%E6%BC%94%E7%BF%92%E5%95%8F%E9%A1%8C"><span class="header-section-number">18.3.1</span> RStudio Primers: 対話型の演習問題</a></li></ul>
</li>
<li>
<a class="nav-link" href="#%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6-dplyr-ii"><span class="header-section-number">18.4</span> 例から学ぶ dplyr, II</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#df_wdi-df_wdi_extra"><span class="header-section-number">18.4.1</span> df_wdi, df_wdi_extra</a></li>
<li><a class="nav-link" href="#ggplot2"><span class="header-section-number">18.4.2</span> ggplot2</a></li>
<li><a class="nav-link" href="#dplyr-%E3%81%AE%E5%BF%9C%E7%94%A8"><span class="header-section-number">18.4.3</span> dplyr の応用</a></li>
<li><a class="nav-link" href="#filter"><span class="header-section-number">18.4.4</span> filter</a></li>
<li><a class="nav-link" href="#%E7%B7%B4%E7%BF%92-3"><span class="header-section-number">18.4.5</span> 練習</a></li>
<li><a class="nav-link" href="#group_by-%E3%81%A8-summarize"><span class="header-section-number">18.4.6</span> group_by と summarize</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E7%B7%B4%E7%BF%92%E5%95%8F%E9%A1%8C"><span class="header-section-number">18.5</span> 練習問題</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/icu-hsuzuki/ds4aj/blob/master/25-transform.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/icu-hsuzuki/ds4aj/edit/master/25-transform.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>データサイエンスをはじめましょう<br>
- Data Science for All -</strong>" was written by 鈴木寛（Hiroshi Suzuki）. It was last built on 2023-09-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
